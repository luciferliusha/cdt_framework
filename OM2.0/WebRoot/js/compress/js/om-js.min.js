var validateRegExp={email:"^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$",url:"^(http|https|ftp)://([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&amp;%$-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|localhost|([a-zA-Z0-9-]+.)*[a-zA-Z0-9-]+.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-{}:\"]+))*$",password:"^[0-9A-Za-z\\!\\$\\%\\^\\&\\*\\.\\~\\_\\-@\\,\\.]{6,16}$",phone:"^(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{7,8}$",mobilePhone:"^1[0-9]{10}$",singleQuotation:"[\\''<>]"};
var validateRules={isUrl:function(str){return new RegExp(validateRegExp.url).test(str);},isEmail:function(str){return new RegExp(validateRegExp.email).test(str);},isPassword:function(str){return new RegExp(validateRegExp.password).test(str);},isPhone:function(str){return new RegExp(validateRegExp.phone).test(str);},isMobilePhone:function(str){return new RegExp(validateRegExp.mobilePhone).test(str);},isSingleQuotation:function(str){return new RegExp(validateRegExp.singleQuotation).test(str);}};function containSpecial(s){var containSpecial=RegExp(/[(\ )(\~)(\!)(\@)(\#)(\$)(\%)(\^)(\&)(\*)(\()(\))(\-)(\_)(\+)(\=)(\[)(\])(\{)(\})(\|)(\\)(\;)(\:)(\')(\")(\,)(\.)(\/)(\<)(\>)(\?)(\)]+/);
return(containSpecial.test(s));}function ValidateSpecialCharacter(){var code;if(document.all){code=window.event.keyCode;}else{code=arguments.callee.caller.arguments[0].which;}var character=String.fromCharCode(code);var txt=new RegExp("[ ,\\`,\\~,\\!,\\@,#,\\$,\\^,\\+,\\*,\\&,\\\\,\\/,\\?,\\|,\\:,\\.,\\<,\\>,\\{,\\},\\'',\\;,\\=,\"]");if(txt.test(character)){if(document.all){window.event.returnValue=false;}else{arguments.callee.caller.arguments[0].preventDefault();}}}if(!this.JSON2){this.JSON2={};
}(function(){function f(n){return n<10?"0"+n:n;}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];
if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}if(typeof JSON2.stringify!=="function"){JSON2.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";
}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON2.stringify");}return str("",{"":value});};}if(typeof JSON2.parse!=="function"){JSON2.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;
}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON2.parse");
};}}());function HashMap(){var size=0;var entry=new Object();this.put=function(key,value){if(!this.containsKey(key)){size++;entry[key]=value;}};this.get=function(key){return this.containsKey(key)?entry[key]:null;};this.remove=function(key){if(this.containsKey(key)&&(delete entry[key])){size--;}};this.containsKey=function(key){return(key in entry);};this.containsValue=function(value){for(var prop in entry){if(entry[prop]==value){return true;}}return false;};this.values=function(){var values=new Array();
for(var prop in entry){values.push(entry[prop]);}return values;};this.keys=function(){var keys=new Array();for(var prop in entry){keys.push(prop);}return keys;};this.size=function(){return size;};this.clear=function(){size=0;entry=new Object();};this.clone=function(oldMap){for(var i=0;i<oldMap.keys().length;i++){this.put(oldMap.keys()[i],oldMap.get(oldMap.keys()[i]));}return this;};}function getDateStr(n){var today=new Date();today.setDate(today.getDate()+n);var y=today.getFullYear();var m=today.getMonth()+1;
var d=today.getDate();if(m<10){m="0"+m;}if(d<10){d="0"+d;}return y+"-"+m+"-"+d;}function getYearWeek(a,b,c){var date1=new Date(a,parseInt(b)-1,c);var date2=new Date(a,0,1);var d=Math.round((date1.valueOf()-date2.valueOf())/86400000);return Math.ceil((d+((date2.getDay()+1)-1))/7);}function formatNum(s,n){n=n>0&&n<=20?n:2;s=parseFloat((s+"").replace(/[^\d\.-]/g,"")).toFixed(n)+"";var l=s.split(".")[0].split("").reverse(),r=s.split(".")[1];t="";for(var i=0;i<l.length;i++){t+=l[i]+((i+1)%3==0&&(i+1)!=l.length?",":"");
}return t.split("").reverse().join("")+"."+r;}function formatInt(num){var snum=(num+"").split("").reverse();var t="";for(var i=0;i<snum.length;i++){t+=snum[i]+((i+1)%3==0&&(i+1)!=snum.length?",":"");}return t.split("").reverse().join("");}Date.prototype.format=function(fmt){var year=this.getFullYear();var month=this.getMonth()+1;fmt=fmt.replace("yyyy",year);fmt=fmt.replace("yy",year%100);fmt=fmt.replace("MM",fix(month));fmt=fmt.replace("dd",fix(this.getDate()));fmt=fmt.replace("hh",fix(this.getHours()));
fmt=fmt.replace("mm",fix(this.getMinutes()));fmt=fmt.replace("ss",fix(this.getSeconds()));return fmt;function fix(n){return n<10?"0"+n:n;}};function limit(id,length){var len=0;var text="";$("#"+id).each(function(){var str=$(this).children("span").text();for(var j=0;j<str.length;j++){var c=str.charCodeAt(j);if((c>=1&&c<=126)||(65376<=c&&c<=65439)){len++;}else{len+=2;}if(len==length){if(j<(str.length-1)){text=str.substring(0,j+1);$(this).children("span").html(text+"...");$(this).children("span").attr("title",str);
break;}}else{if(len>length){text=str.substring(0,j);$(this).children("span").html(text+"...");$(this).children("span").attr("title",str);break;}else{$(this).children("span").removeAttr("title");}}}});}function name_limit(name,length){var len=0;for(var i=0;i<name.length;i++){var c=name.charCodeAt(i);if((c>=1&&c<=126)||(65376<=c&&c<=65439)){if(c>=48&&c<=57){len++;}else{len=len+1.5;}}else{len+=2;}if(len==length){}if(len==length){if(i<(name.length-1)){name=name.substring(0,i+1)+"...";break;}}else{if(len>length){name=name.substring(0,i)+"...";
break;}}}return name;}function loginFocus(nameId,passwordId,checkId,passwordInfoId){var userid_cookie=getCookieValue("username");var pwd_cookie=getCookieValue("password");if(userid_cookie!=undefined&&userid_cookie!=""&&userid_cookie!="undefined"&&typeof(userid_cookie)!="undefined"){$(nameId).val(userid_cookie);}if(pwd_cookie!=undefined&&pwd_cookie!=""&&pwd_cookie!="undefined"&&typeof(pwd_cookie)!="undefined"){$(passwordId).val(pwd_cookie);$(checkId).removeClass("checkbox-login-n");$(checkId).addClass("checkbox-login-p");
$(passwordInfoId).hide();$(passwordId).show();}}function addCookie(checked,nameId,passwordId){if(checked){var username=$.trim($(nameId).val());var password=$(passwordId).val();setCookie("username",username,120,"/");setCookie("password",password,120,"/");}else{deleteCookie("username","/");deleteCookie("password","/");}}function addOmSearchCookie(array){setCookie("omSearch",array,120,"/");}function getOmSearchCookie(){return unescape(getCookieValue("omSearch"));}function setCookie(name,value,hours,path){var name=escape(name);
var value=escape(value);var expires=new Date();expires.setTime(expires.getTime()+hours*3600000);path=path==""?"":";path="+path;_expires=(typeof hours)=="string"?"":";expires="+expires.toUTCString();document.cookie=name+"="+value+_expires+path;}function getCookieValue(name){var name=escape(name);var allcookies=document.cookie;name+="=";var pos=allcookies.indexOf(name);if(pos!=-1){var start=pos+name.length;var end=allcookies.indexOf(";",start);if(end==-1){end=allcookies.length;}var value=allcookies.substring(start,end);
return(value);}else{return"";}}function deleteCookie(name,path){var name=escape(name);var expires=new Date(0);path=path==""?"":";path="+path;document.cookie=name+"="+";expires="+expires.toUTCString()+path;}var omTopView;var windowView;var organizationView;var roleView;var resourceView;$(function(){omTopView=new OmTopView();organizationView=new OrganizationView();roleView=new RoleView();resourceView=new ResourceView();windowView=new WindowView();omTopView.init();organizationView.init();roleView.init();
resourceView.init();bindEasyUiMenuEvent();});function bindEasyUiMenuEvent(){$(".easyui-menu .menu-item").height("31px");var menus=["add","rename","move","relieve","contain","trash"];$(".easyui-menu .menu-item").hover(function(){var _icon=$(this).find(".menu-icon");for(var i=0;i<menus.length;i++){if(_icon.hasClass("icon-"+menus[i]+"-n")){_icon.removeClass("icon-"+menus[i]+"-n");_icon.addClass("icon-"+menus[i]+"-f");break;}}},function(){var _icon=$(this).find(".menu-icon");for(var i=0;i<menus.length;
i++){if(_icon.hasClass("icon-"+menus[i]+"-f")){_icon.removeClass("icon-"+menus[i]+"-f");_icon.addClass("icon-"+menus[i]+"-n");break;}}});}var initMenu=function(zTree,treeNode,menuId,event){if(treeNode.isParent&&!treeNode.open){zTree.expandNode(treeNode,true,false,true);}$("#"+menuId).menu("show",{left:event.clientX,top:event.clientY});if(treeNode.getParentNode()==null){var menus=[{"name":"重命名","iconCls":"icon-rename-d"},{"name":"添加用户","iconCls":"icon-contain-d"},{"name":"删除","iconCls":"icon-trash-d"},{"name":"详细信息"}];
for(var i=0;i<menus.length;i++){var item=$("#"+menuId).menu("findItem",menus[i].name);if(item&&!item.disabled){$("#"+menuId).menu("disableItem",item.target);if(menus[i].iconCls){$("#"+menuId).menu("setIcon",{target:item.target,iconCls:menus[i].iconCls});}$(item.target).children(".menu-text").addClass("menu-text-disabled");}}}else{var menus=[{"name":"重命名","iconCls":"icon-rename-n"},{"name":"添加用户","iconCls":"icon-contain-n"},{"name":"删除","iconCls":"icon-trash-n"},{"name":"详细信息"}];for(var i=0;i<menus.length;
i++){var item=$("#"+menuId).menu("findItem",menus[i].name);if(item&&item.disabled){$("#"+menuId).menu("enableItem",item.target);if(menus[i].iconCls){$("#"+menuId).menu("setIcon",{target:item.target,iconCls:menus[i].iconCls});}$(item.target).children(".menu-text").removeClass("menu-text-disabled");}}}};function appendOmNode(treeId){switch(treeId){case"organizationZTree":windowView.initNewChooseWin();break;case"roleZTree":windowView.initRenameWin(treeId,"new");break;case"resourceZTree":windowView.initNewResourceWin("new");
break;}}function updateOmNode(treeId){switch(treeId){case"organizationZTree":case"roleZTree":windowView.initRenameWin(treeId,"rename");break;case"resourceZTree":windowView.initNewResourceWin("rename");break;}}function removeOmNode(treeId,operateType){if(!operateType){operateType="delete";}windowView.initDeleteWin(treeId,operateType);}function containOmNode(){windowView.initContainUserWin();}function relieveOmNode(){windowView.initRelieveOrganizationWin();}function showMoreInformation(){windowView.initMoreInformationWin();
}function isHintInputEmpty(_target){var defaultValue=_target.attr("defaultValue");if($.trim(_target.val())==defaultValue&&_target.hasClass("input_hint")){return true;}return false;}function getZTreeAllParentNodes(treeNode,treeId,rootId,parentNodesArr){if(treeNode.id==rootId){return;}var parentNode=treeNode.getParentNode();parentNodesArr.push(parentNode);if(parentNode.id!=rootId){getZTreeAllParentNodes(parentNode,treeId,rootId,parentNodesArr);}}function getZTreeAllChildrenNodes(treeNode,treeId,rootId,childrenNodesArr){if(!treeNode.isParent){return;
}var childrenNodes=treeNode.children;for(var i=0;i<childrenNodes.length;i++){childrenNodesArr.push(childrenNodes[i]);if(childrenNodes[i].isParent){getZTreeAllChildrenNodes(childrenNodes[i],treeId,rootId,childrenNodesArr);}}}function OrganizationService(){var omOperateOrganizationUrl=path+"/ts/omOperateOrganization?";var omSerachOrganizationZTreeUrl=path+"/ts/omSerachOrganizationZTree?";var omUserIsExitUrl=path+"/ts/omUserIsExit?";var omRemoveRelationUrl=path+"/ts/omRemoveRelation?";var omGetUserByOrganizationUrl=path+"/ts/omGetUserByOrganization?";
var omOrganizationSelectUserUrl=path+"/ts/omOrganizationSelectUser?";var omGetOrganizationByUserUrl=path+"/ts/omGetOrganizationByUser?";var omUserSelectOrganizationUrl=path+"/ts/omUserSelectOrganization?";var omUpdatePasswordUrl=path+"/ts/omUpdatePassword?";var omGetOrganizationRoleUrl=path+"/ts/omGetOrganizationRole?";var omGetUserRoleUrl=path+"/ts/omGetUserRole?";var omAwardPermissionUrl=path+"/ts/omAwardPermission";this.omOperateOrganization=function(callBack,param,_winId){$.HttpUtil.doAjax(omOperateOrganizationUrl,param,function(ret){if(callBack){callBack(ret.data,param,_winId);
}});};this.omSerachOrganizationZTree=function(callBack,param){$.HttpUtil.doAjax(omSerachOrganizationZTreeUrl,param,function(ret){if(callBack){callBack(ret.data);}});};this.omUserIsExit=function(callBack,param){$.HttpUtil.doSimpleAjax(omUserIsExitUrl,param,function(response){if(callBack){callBack(response);}});};this.omRemoveRelation=function(callBack,param){$.HttpUtil.doSimpleAjax(omRemoveRelationUrl,param,function(response){if(callBack){callBack(response);}});};this.omGetUserByOrganization=function(callBack,param){$.HttpUtil.doAjax(omGetUserByOrganizationUrl,param,function(ret){if(callBack){callBack(ret.data);
}});};this.omOrganizationSelectUser=function(callBack,param,allUserData){$.HttpUtil.doAjax(omOrganizationSelectUserUrl,param,function(ret){if(callBack){callBack(ret.data,param,allUserData);}});};this.omGetOrganizationByUser=function(callBack,param){$.HttpUtil.doAjax(omGetOrganizationByUserUrl,param,function(ret){if(callBack){callBack(ret.data);}});};this.omUserSelectOrganization=function(callBack,param){$.HttpUtil.doAjax(omUserSelectOrganizationUrl,param,function(ret){if(callBack){callBack(param);
}});};this.omUpdatePassword=function(callBack,param){$.HttpUtil.doSimpleAjax(omUpdatePasswordUrl,param,function(ret){if(callBack){callBack(ret);}});};this.omGetOrganizationRole=function(callBack,param){$.HttpUtil.doAjax(omGetOrganizationRoleUrl,param,function(ret){if(callBack){callBack(ret.data);}});};this.omGetUserRole=function(callBack,param){$.HttpUtil.doAjax(omGetUserRoleUrl,param,function(ret){if(callBack){callBack(ret.data);}});};this.omAwardPermission=function(callBack,param,isShowTip){$.HttpUtil.doAjax(omAwardPermissionUrl,param,function(ret){if(callBack){callBack(param,isShowTip);
}});};}function ResourceService(){var omOperateResourceUrl=path+"/ts/omOperateResource?";var omSearchResourceUrl=path+"/ts/omSearchResource?";var omCheckNoIsExitUrl=path+"/ts/omCheckNoIsExit?";this.omOperateResource=function(callBack,param){$.HttpUtil.doAjax(omOperateResourceUrl,param,function(ret){if(callBack){callBack(ret.data,param);}});};this.omSearchResource=function(callBack,param){$.HttpUtil.doAjax(omSearchResourceUrl,param,function(ret){if(callBack){callBack(ret.data);}});};this.omCheckNoIsExit=function(callBack,param){$.HttpUtil.doSimpleAjax(omCheckNoIsExitUrl,param,function(ret){if(callBack){callBack(ret);
}});};}function RoleService(){var omOperateRoleUrl=path+"/ts/omOperateRole?";var omSearchRoleUrl=path+"/ts/omSerachRole?";var omGetRoleResourceUrl=path+"/ts/omGetRoleResource?";var omAwardResourceUrl=path+"/ts/omAwardResource?";this.omOperateRole=function(callBack,param){$.HttpUtil.doAjax(omOperateRoleUrl,param,function(ret){if(callBack){callBack(ret.data,param);}});};this.omSearchRole=function(callBack,param){$.HttpUtil.doAjax(omSearchRoleUrl,param,function(ret){if(callBack){callBack(ret.data);}});
};this.omGetRoleResource=function(callBack,param){$.HttpUtil.doAjax(omGetRoleResourceUrl,param,function(ret){if(callBack){callBack(ret.data);}});};this.omAwardResource=function(callBack,param,isShowTip){$.HttpUtil.doAjax(omAwardResourceUrl,param,function(ret){if(callBack){callBack(param,isShowTip);}});};}function OmTopView(){var omSearchArray=new Array();var omSearchArrayMaxLength=5;var omSearchItemHeight=35;var selectSearchMenuItemId="search_organization_item";var bindSearchInputEvent=function(){if(!($._data($("#search_input").get(0),"events")!=undefined&&$._data($("#search_input").get(0),"events")["focus"]!=undefined)){$("#search_input").bind("focus",function(){if(isHintInputEmpty($(this))){$(this).val("");
$(this).removeClass("input_hint");$(this).addClass("input_normal");}$(".search_input_bg").removeClass("search_input_bg_n");$(".search_input_bg").addClass("search_input_bg_f");showOmSearchArray();});$("#search_input").bind("blur",function(){var defaultValue=$(this).attr("defaultValue");if($.trim($(this).val())==""){$(this).val(defaultValue);$(this).removeClass("input_normal");$(this).addClass("input_hint");}$(".search_input_bg").removeClass("search_input_bg_f");$(".search_input_bg").addClass("search_input_bg_n");
});}if(!($._data($("#search_input").get(0),"events")!=undefined&&$._data($("#search_input").get(0),"events")["keydown"]!=undefined)){$("#search_input").bind("keydown",function(e){if(e.keyCode==13){startSearch();}});}};var bindSearchButtonEvent=function(){if(!($._data($("#search_button").get(0),"events")!=undefined&&$._data($("#search_button").get(0),"events")["click"]!=undefined)){$("#search_button").bind("click",function(){startSearch();});}};var startSearch=function(){var name=$.trim($("#search_input").val());
var showSearchName=name_limit(name,14);if(isHintInputEmpty($("#search_input"))){$.messager.alert("操作提示","搜索内容不能为空！","info");return;}else{if($.trim($("#search_input").val())==""){$.messager.alert("操作提示","搜索内容不能为空！","info");return;}}switch(selectSearchMenuItemId){case"search_organization_item":$("#organization_result_span_tip").hide();$(".organization_result_span").hide();$("#organization_search_name_div").show();$("#organization_search_name").text(showSearchName);if(name!=showSearchName){$("#organization_search_name").attr("title",name);
}else{$("#organization_search_name").removeAttr("title");}organizationView.omSearchOrganization(name);break;case"search_role_item":$("#role_result_span_tip").hide();$(".role_result_span").hide();$("#role_search_name_div").show();$("#role_search_name").text(showSearchName);if(name!=showSearchName){$("#role_search_name").attr("title",name);}else{$("#role_search_name").removeAttr("title");}roleView.omSearchRole(name);break;case"search_resource_item":$("#resource_result_span_tip").hide();$(".resource_result_span").hide();
$("#resource_search_name_div").show();$("#resource_search_name").text(showSearchName);if(name!=showSearchName){$("#resource_search_name").attr("title",name);}else{$("#resource_search_name").removeAttr("title");}resourceView.omSearchResource(name);break;}addToOmSearchArray(name);};var bindSearchCategoryEvent=function(){if(!($._data($("#search_category").get(0),"events")!=undefined&&$._data($("#search_category").get(0),"events")["click"]!=undefined)){$("#search_category").bind("click",function(){if($("#search_category_menu").is(":visible")){$("#search_category_menu").fadeOut();
}else{$("#search_category_menu").fadeIn();$("#search_category_menu").focus();}});$("#search_category").bind("mousedown",function(){return false;});}if(!($._data($("#search_category_menu ul li").get(0),"events")!=undefined&&$._data($("#search_category_menu ul li").get(0),"events")["click"]!=undefined)){$("#search_category_menu ul li").bind("click",function(){var id=this.id;var name="";if(id==selectSearchMenuItemId){$("#search_category_menu").fadeOut();return;}$("#"+selectSearchMenuItemId).removeClass("menu_li_f");
switch(id){case"search_organization_item":name="组织";break;case"search_role_item":name="角色";break;case"search_resource_item":name="资源";break;}selectSearchMenuItemId=id;$("#"+selectSearchMenuItemId).addClass("menu_li_f");$("#search_category_span").text(name);$("#search_input").attr("defaultValue","按"+name+"搜索");if($("#search_input").hasClass("input_normal")){$("#search_input").removeClass("input_normal");$("#search_input").addClass("input_hint");}$("#search_input").val("按"+name+"搜索");$("#search_category_menu").fadeOut();
});}if(!($._data($("#search_category_menu").get(0),"events")!=undefined&&$._data($("#search_category_menu").get(0),"events")["blur"]!=undefined)){$("#search_category_menu").bind("blur",function(){var browser=navigator.userAgent;if(browser.indexOf("MSIE")!=-1){if(document.activeElement.id!="search_category"){if($("#search_category_menu").is(":visible")){$("#search_category_menu").fadeOut();}}}else{if($("#search_category_menu").is(":visible")){$("#search_category_menu").fadeOut();}}});}};var bindSearchCloseEvent=function(){if(!($._data($(".search_close").get(0),"events")!=undefined&&$._data($(".search_close").get(0),"events")["click"]!=undefined)){$(".search_close").bind("click",function(){var id=this.id;
switch(id){case"organization_search_close":$("#organization_result_span_tip").hide();$("#organization_search_name_div").hide();$(".organization_result_span").show();organizationView.unOmSearchOrganization();break;case"role_search_close":$("#role_result_span_tip").hide();$("#role_search_name_div").hide();$(".role_result_span").show();roleView.unOmSearchRole();break;case"resource_search_close":$("#resource_result_span_tip").hide();$("#resource_search_name_div").hide();$(".resource_result_span").show();
resourceView.unOmSearchResource();break;}});}};var addToOmSearchArray=function(name){if(omSearchArray.length>=omSearchArrayMaxLength){omSearchArray.shift();}omSearchArray.push(name);addToCookie(omSearchArray);};var showOmSearchArray=function(){if(omSearchArray.length==0){omSearchArray=getFromCookie();}if(omSearchArray.length>0){$("#searchRecord").height(omSearchArray.length*omSearchItemHeight);$("#searchRecord").empty();var index=omSearchArray.length;while(index--){$("#searchRecord").append("<li>"+omSearchArray[index]+"</li>");
}$("#searchRecord").show();$("#searchRecord li").die("click").live("click",function(){$("#search_input").val($(this).text());$("#searchRecord").hide();if($("#search_input").hasClass("input_hint")){$("#search_input").removeClass("input_hint");$("#search_input").addClass("input_normal");}});}};var binOmsaveEvent=function(){if(!($._data($("#omsave").get(0),"events")!=undefined&&$._data($("#omsave").get(0),"events")["click"]!=undefined)){$("#omsave").bind("click",function(){if($(this).attr("disabled")){return;
}else{$(this).attr("disabled",true);}var isRoleTipShow=true;var isResourceTipShow=true;var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");var selectOrganizationNode=organizationZTree.getSelectedNodes()[0];var selectRoleNode=roleZTree.getSelectedNodes()[0];if(selectOrganizationNode){var changeCheckedRolesData=organizationView.getChangeCheckedRolesData(selectOrganizationNode);if(changeCheckedRolesData&&changeCheckedRolesData.length>0){organizationView.saveOrganizationPermission(selectOrganizationNode,changeCheckedRolesData,true);
isRoleTipShow==true;isResourceTipShow=false;}else{isRoleTipShow=false;}}else{isRoleTipShow=false;}if(selectRoleNode){var changeCheckedResourcesData=roleView.getChangeCheckedResourceData(selectRoleNode);if(changeCheckedResourcesData&&changeCheckedResourcesData.length>0){roleView.saveRolePermission(selectRoleNode,changeCheckedResourcesData,isResourceTipShow);}else{isResourceTipShow=false;}}else{isResourceTipShow=false;}if(!isRoleTipShow&&!isResourceTipShow){$(this).removeAttr("disabled",true);if(selectOrganizationNode||selectRoleNode){$.messager.alert("操作提示","保存成功！","info");
}}});}};var bindDocumentEvent=function(){$(document).bind("click",function(event){var e=event||window.event;var target=e.srcElement||e.target;if($(target).attr("id")!="search_input"){$("#searchRecord").hide();}});};var addToCookie=function(array){var result=new Array();for(var i=0;i<array.length;i++){var json={"reslut":array[i]};result.push(json);}addOmSearchCookie(JSON2.stringify(result));};function getFromCookie(){var array=getOmSearchCookie();var result=new Array();if(array==""){result=new Array();
}else{array=JSON2.parse(array);for(var i=0;i<array.length;i++){result.push(array[i].reslut);}}return result;}this.init=function(){$("#search_input").val("按组织搜索");bindSearchInputEvent();bindSearchButtonEvent();bindSearchCategoryEvent();bindSearchCloseEvent();binOmsaveEvent();bindDocumentEvent();};this.removeOmsaveDisable=function(){$("#omsave").removeAttr("disabled",true);};}function OrganizationView(){var ORGANIZATION_ROOT_ID=-1;var selectOrganizationNode=null;var USER_TYPE=1;var ORGANIZATION_TYPE=0;
var organizationService=new OrganizationService();var searchOrganizationData=null;var organizationRoleData=new HashMap();var _organizationView=this;var appendOrganizationNode=function(data,param,_winId){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var parentNode=organizationZTree.getSelectedNodes()[0];var paramData=JSON2.parse(param.data);var newRoleNodes=[];var newRoleNodeJson={};newRoleNodeJson["id"]=data;for(var key in paramData){newRoleNodeJson[key]=paramData[key];if(key=="type"){if(paramData[key]==ORGANIZATION_TYPE){newRoleNodeJson["iconSkin"]="icon-organization-single";
}else{if(paramData[key]==USER_TYPE){newRoleNodeJson["iconSkin"]="icon-user";}}}}newRoleNodes.push(newRoleNodeJson);if(!parentNode.isParent){parentNode.iconSkin="icon-organization-double-s";organizationZTree.updateNode(parentNode);}organizationZTree.addNodes(parentNode,newRoleNodes);$(".blackboard-css").hide();$("#"+_winId).fadeOut(function(){$("#"+_winId).remove();});};var renameOrganizationNode=function(data,param){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];
var paramData=JSON2.parse(param.data);if(selectNode.type==USER_TYPE){var treeNodes=organizationZTree.getNodesByParam("id",selectNode.id);for(var i=0;i<treeNodes.length;i++){treeNodes[i].name=paramData.name;organizationZTree.updateNode(treeNodes[i]);}}else{if(selectNode.type==ORGANIZATION_TYPE){selectNode.name=paramData.name;organizationZTree.updateNode(selectNode);}}$(".blackboard-css").hide();$("#renameWin").fadeOut(function(){$("#renameWin").remove();});};var updateOrganizationNode=function(data,param,_winId){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");
var selectNode=organizationZTree.getSelectedNodes()[0];var paramData=JSON2.parse(param.data);if(selectNode.type==ORGANIZATION_TYPE){for(var key in paramData){selectNode[key]=paramData[key];}organizationZTree.updateNode(selectNode);}else{if(selectNode.type==USER_TYPE){var id=selectNode.id;var treeNodes=organizationZTree.getNodesByParam("id",id,null);for(var i=0;i<treeNodes.length;i++){for(var key in paramData){treeNodes[i][key]=paramData[key];}organizationZTree.updateNode(treeNodes[i]);}}}$(".blackboard-css").hide();
$("#"+_winId).remove();};var deleteOrganizationNode=function(data){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];if(selectNode.type==USER_TYPE){var id=selectNode.id;var treeNodes=organizationZTree.getNodesByParam("id",id,null);for(var i=0;i<treeNodes.length;i++){var parentNode=treeNodes[i].getParentNode();organizationZTree.removeNode(treeNodes[i]);if(!parentNode.isParent){parentNode.iconSkin="icon-organization-single";organizationZTree.updateNode(parentNode);
}}}else{if(selectNode.type==ORGANIZATION_TYPE){var rootNode=organizationZTree.getNodeByParam("id",ORGANIZATION_ROOT_ID,null);var parentNode=selectNode.getParentNode();organizationZTree.removeNode(selectNode);if(!parentNode.isParent){parentNode.iconSkin="icon-organization-single";organizationZTree.updateNode(parentNode);}if(data&&data.length>0){for(var i=0;i<data.length;i++){data[i]["parentId"]=ORGANIZATION_ROOT_ID;data[i]["iconSkin"]="icon-user";}organizationZTree.addNodes(rootNode,data);}}}organizationRoleData.remove(selectOrganizationNode.id);
selectOrganizationNode=null;unCheckAllRoleNodes();$(".blackboard-css").hide();$("#deleteWin").fadeOut(function(){$("#deleteWin").remove();});};var relieveRelatUserNode=function(response){if(response.returnFlag=="-1"){$.messager.alert("操作提示",response.data,"info");}else{if(response.returnFlag=="0"){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];var parentNode=selectNode.getParentNode();organizationZTree.removeNode(selectNode);
if(!parentNode.isParent){parentNode.iconSkin="icon-organization-single";organizationZTree.updateNode(parentNode);}}}selectOrganizationNode=null;unCheckAllRoleNodes();$(".blackboard-css").hide();$("#deleteWin").fadeOut(function(){$("#deleteWin").remove();});};var changeOrganizationContainUser=function(data,param,allUserData){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];var rootNode=organizationZTree.getNodeByParam("id",ORGANIZATION_ROOT_ID,null);
var paramData=JSON2.parse(param.data).value;for(var i=0;i<paramData.length;i++){if(paramData[i].type==0){for(var j=0;j<allUserData.length;j++){if(paramData[i].id==allUserData[j].id){allUserData[j].iconSkin="icon-user";allUserData[j].parentId=selectNode.id;organizationZTree.addNodes(selectNode,[allUserData[j]]);break;}}}else{if(paramData[i].type==1){var childrenNodes=selectNode.children;for(var j=0;j<childrenNodes.length;j++){if(paramData[i].id==childrenNodes[j].id){organizationZTree.removeNode(childrenNodes[j]);
break;}}}}}if(!selectNode.isParent&&selectNode.iconSkin=="icon-organization-double-s"){selectNode.iconSkin="icon-organization-single-s";organizationZTree.updateNode(selectNode);}else{if(selectNode.isParent&&selectNode.iconSkin=="icon-organization-single-s"){selectNode.iconSkin="icon-organization-double-s";organizationZTree.updateNode(selectNode);}}if(data&&data.length>0){for(var i=0;i<data.length;i++){for(var j=0;j<allUserData.length;j++){if(data[i]==allUserData[j].id){allUserData[j].iconSkin="icon-user";
allUserData[j].parentId=ORGANIZATION_ROOT_ID;organizationZTree.addNodes(rootNode,[allUserData[j]]);break;}}}}$(".blackboard-css").hide();$("#containUserWin").fadeOut(function(){$("#containUserWin").remove();});};var changeUserRelieveOrganization=function(param){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];var paramData=JSON2.parse(param.data).value;for(var i=0;i<paramData.length;i++){var organizationNode=organizationZTree.getNodeByParam("id",paramData[i].id,null);
if(paramData[i].type==0){if(!organizationNode.isParent){organizationNode.iconSkin="icon-organization-double";organizationZTree.updateNode(organizationNode);}selectNode.iconSkin="icon-user";organizationZTree.copyNode(organizationNode,selectNode,"inner");}else{if(paramData[i].type==1){var userNodes=organizationZTree.getNodesByParam("id",selectNode.id,null);for(var j=0;j<userNodes.length;j++){var parentNode=userNodes[j].getParentNode();if(paramData[i].id==parentNode.id){organizationZTree.removeNode(userNodes[j]);
if(!parentNode.isParent){parentNode.iconSkin="icon-organization-single";organizationZTree.updateNode(parentNode);}break;}}}}}if(organizationZTree.getSelectedNodes().length==0){selectOrganizationNode=null;unCheckAllRoleNodes();}$(".blackboard-css").hide();$("#relieveOrganizationWin").fadeOut(function(){$("#relieveOrganizationWin").remove();});};var showSearchOrganizationData=function(data){searchOrganizationData=data;if(data.length==0){$("#organization_result_span_tip").show();}else{if(data.length>0){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");
for(var i=0;i<data.length;i++){var treeNodes=organizationZTree.getNodesByParam("id",data[i].id);for(var j=0;j<treeNodes.length;j++){if($("#"+treeNodes[j].tId+"_a").length==0){organizationZTree.selectNode(treeNodes[j]);}$("#"+treeNodes[j].tId+"_span").addClass("search_node_color");}}if($("#organization_operate").height()<$("#organizationZTree").height()){$("#organization_operate").scrollTop(0);}if(selectOrganizationNode){organizationZTree.selectNode(selectOrganizationNode);}else{organizationZTree.cancelSelectedNode();
}}}};var updateUserPassword=function(response){if(response.returnFlag=="-1"){$.messager.alert("操作提示",response.data,"info");}$(".blackboard-css").hide();$("#changePasswordWin").fadeOut(function(){$("#changePasswordWin").remove();});};var checkRoleNodes=function(treeNode){var id=treeNode.id;if(id==ORGANIZATION_ROOT_ID){return;}if(organizationRoleData.get(id)){roleView.checkRoleNodes(organizationRoleData.get(id));}else{var type=treeNode.type;var param={data:JSON2.stringify({"id":id})};if(type==ORGANIZATION_TYPE){organizationService.omGetOrganizationRole(function(data){roleView.checkRoleNodes(data);
organizationRoleData.put(id,data);},param);}else{if(type==USER_TYPE){organizationService.omGetUserRole(function(data){roleView.checkRoleNodes(data);organizationRoleData.put(id,data);},param);}}}};var unCheckAllRoleNodes=function(){roleView.unCheckAllRoleNodes();};var awardPermission=function(param,isShowTip){var id=JSON2.parse(param.data).id;var paramData=JSON2.parse(param.data).value;var data=organizationRoleData.get(id);for(var i=0;i<paramData.length;i++){if(paramData[i].type==0){var json={"id":paramData[i].id};
data.push(json);}else{if(paramData[i].type==1){for(var j=0;j<data.length;j++){if(paramData[i].id==data[j].id){data.splice(j,1);break;}}}}}organizationRoleData.remove(id);organizationRoleData.put(id,data);if(isShowTip){$.messager.alert("操作提示","保存成功！","info");omTopView.removeOmsaveDisable();}};var initOrganizationZTree=function(){var setting={async:{enable:true,url:path+"/ts/omGetOrganizationZTree?",autoParam:["id"]},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId",rootPId:-2}},view:{showLine:false},callback:{onRightClick:onRightClick,onClick:onClick}};
var zNodes=[{"id":ORGANIZATION_ROOT_ID,"name":"组织","type":0,"parentId":-2,"open":false,"isParent":true,"iconSkin":"icon-organization-double"}];$.fn.zTree.init($("#organizationZTree"),setting,zNodes);var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var rootNode=organizationZTree.getNodeByParam("id",ORGANIZATION_ROOT_ID,null);organizationZTree.expandNode(rootNode,true,false,true);};var onClick=function(event,treeId,treeNode){var organizationZTree=$.fn.zTree.getZTreeObj(treeId);if(selectOrganizationNode){if(selectOrganizationNode.id==treeNode.id&&selectOrganizationNode.parentId==treeNode.parentId){return;
}if(selectOrganizationNode.type==ORGANIZATION_TYPE){if(selectOrganizationNode.isParent){selectOrganizationNode.iconSkin="icon-organization-double";}else{selectOrganizationNode.iconSkin="icon-organization-single";}}else{if(selectOrganizationNode.type==USER_TYPE){selectOrganizationNode.iconSkin="icon-user";}}organizationZTree.updateNode(selectOrganizationNode);omAwardPermission(selectOrganizationNode);unCheckAllRoleNodes();}else{unCheckAllRoleNodes();}selectOrganizationNode=treeNode;if(treeNode.type==ORGANIZATION_TYPE){if(treeNode.isParent){treeNode.iconSkin="icon-organization-double-s";
}else{treeNode.iconSkin="icon-organization-single-s";}}else{if(treeNode.type==USER_TYPE){treeNode.iconSkin="icon-user-s";}}organizationZTree.updateNode(treeNode);checkRoleNodes(treeNode);};var onRightClick=function(event,treeId,treeNode){showMenu(treeId,treeNode,event);};var showMenu=function(treeId,treeNode,event){if(treeNode){var organizationZTree=$.fn.zTree.getZTreeObj(treeId);organizationZTree.selectNode(treeNode);onClick(null,treeId,treeNode);var menuId="";if(treeNode.type==ORGANIZATION_TYPE){menuId="organization_menu";
}else{if(treeNode.type==USER_TYPE){menuId="user_menu";}}initMenu(organizationZTree,treeNode,menuId,event);}};var omAwardPermission=function(treeNode){var id=treeNode.id;if(id==ORGANIZATION_ROOT_ID){return;}var changeCheckedRolesData=_organizationView.getChangeCheckedRolesData(treeNode);if(changeCheckedRolesData&&changeCheckedRolesData.length>0){_organizationView.saveOrganizationPermission(treeNode,changeCheckedRolesData,false);}};this.init=function(){initOrganizationZTree();};this.addZTreeNode=function(data,_winId){var param={type:"add",data:JSON2.stringify(data)};
organizationService.omOperateOrganization(appendOrganizationNode,param,_winId);};this.omUserIsExit=function(email,callBack){var param={data:JSON2.stringify({email:email})};organizationService.omUserIsExit(callBack,param);};this.renameZTreeNode=function(treeNode,name){var param={type:"update",data:JSON2.stringify({id:treeNode.id,name:name,type:treeNode.type})};organizationService.omOperateOrganization(renameOrganizationNode,param);};this.updateZTreeNode=function(treeNode,data,_winId){var param={type:"update",data:JSON2.stringify(data)};
organizationService.omOperateOrganization(updateOrganizationNode,param,_winId);};this.deleteZTreeNode=function(treeNode){var param={type:"delete",data:JSON2.stringify({id:treeNode.id,type:treeNode.type})};organizationService.omOperateOrganization(deleteOrganizationNode,param);};this.relieveRelatZTreeNode=function(treeNode,parentNode){var param={data:JSON2.stringify({organizationId:parentNode.id,userId:treeNode.id})};organizationService.omRemoveRelation(relieveRelatUserNode,param);};this.omGetUserByOrganization=function(callBack,treeNode){var param={data:JSON2.stringify({organizationId:treeNode.id})};
organizationService.omGetUserByOrganization(callBack,param);};this.omChangeOrganizationContainUser=function(treeNode,data,allUserData){var param={data:JSON2.stringify({id:treeNode.id,value:data})};organizationService.omOrganizationSelectUser(changeOrganizationContainUser,param,allUserData);};this.omGetOrganizationByUser=function(callBack,treeNode){var param={data:JSON2.stringify({userId:treeNode.id})};organizationService.omGetOrganizationByUser(callBack,param);};this.omChangeUserRelieveOrganization=function(treeNode,data){var param={data:JSON2.stringify({id:treeNode.id,value:data})};
organizationService.omUserSelectOrganization(changeUserRelieveOrganization,param);};this.omUpdatePassword=function(data){var param={data:JSON2.stringify(data)};organizationService.omUpdatePassword(updateUserPassword,param);};this.omSearchOrganization=function(name){this.unOmSearchOrganization();var param={data:JSON2.stringify({name:name})};organizationService.omSerachOrganizationZTree(showSearchOrganizationData,param);};this.unOmSearchOrganization=function(){if(searchOrganizationData&&searchOrganizationData.length>0){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");
for(var i=0;i<searchOrganizationData.length;i++){var treeNodes=organizationZTree.getNodesByParam("id",searchOrganizationData[i].id);if(treeNodes){for(var j=0;j<treeNodes.length;j++){$("#"+treeNodes[j].tId+"_span").removeClass("search_node_color");}}}}};this.getChangeCheckedRolesData=function(treeNode){var id=treeNode.id;if(id==ORGANIZATION_ROOT_ID){return;}var oldCheckedRolesData=organizationRoleData.get(id);var changeCheckedRolesData=new Array();if(oldCheckedRolesData){changeCheckedRolesData=roleView.getChangeCheckedRolesData(oldCheckedRolesData);
}return changeCheckedRolesData;};this.saveOrganizationPermission=function(treeNode,changeCheckedRolesData,isShowTip){var id=treeNode.id;var type=treeNode.type;var param={"data":JSON2.stringify({"id":id,"type":type,"value":changeCheckedRolesData})};organizationService.omAwardPermission(awardPermission,param,isShowTip);};}function ResourceView(){var RESOURCE_ROOT_ID=0;var selectResourceNode=null;var resourceService=new ResourceService();var searchResourceData=null;var saveRoleNode=null;var appendResourceNode=function(data,param){var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");
var parentNode=resourceZTree.getSelectedNodes()[0];var paramData=JSON2.parse(param.data);var checked=false;if(parentNode.checked&&!parentNode.getCheckStatus().half){checked=true;}var newResourceNodes=[{"id":data,"name":paramData.name+"("+paramData.no+")","no":paramData.no,"status":paramData.status,"parentId":parentNode.id,"iconSkin":"icon-resource-single","checked":checked}];if(!parentNode.isParent){parentNode.iconSkin="icon-resource-double-s";resourceZTree.updateNode(parentNode);}resourceZTree.addNodes(parentNode,newResourceNodes);
$(".blackboard-css").hide();$("#newResourceWin").fadeOut(function(){$("#newResourceWin").remove();});};var updateResourceNode=function(data,param){var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");var selectNode=resourceZTree.getSelectedNodes()[0];var paramData=JSON2.parse(param.data);selectNode.name=paramData.name+"("+paramData.no+")";selectNode.no=paramData.no;resourceZTree.updateNode(selectNode);$(".blackboard-css").hide();$("#newResourceWin").fadeOut(function(){$("#newResourceWin").remove();
});};var deleteResourceNode=function(data,param){var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");var selectNode=resourceZTree.getSelectedNodes()[0];var parentNode=selectNode.getParentNode();resourceZTree.removeNode(selectNode);if(!parentNode.isParent){parentNode.iconSkin="icon-resource-single";resourceZTree.updateNode(parentNode);}selectResourceNode=null;$(".blackboard-css").hide();$("#deleteWin").fadeOut(function(){$("#deleteWin").remove();});};var showSearchResourceData=function(data){searchResourceData=data;
if(data.length==0){$("#resource_result_span_tip").show();}else{if(data.length>0){var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");for(var i=0;i<data.length;i++){var treeNode=resourceZTree.getNodeByParam("id",data[i].id);if($("#"+treeNode.tId+"_a").length==0){resourceZTree.selectNode(treeNode);}$("#"+treeNode.tId+"_span").addClass("search_node_color");}if($("#resource_operate").height()<$("#resourceZTree").height()){$("#resource_operate").scrollTop(0);}if(selectResourceNode){resourceZTree.selectNode(selectResourceNode);
}else{resourceZTree.cancelSelectedNode();}}}};var initResourceZTree=function(){var setting={async:{enable:true,url:path+"/ts/omGetResourceZTree?",autoParam:["id"]},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId",rootPId:-1}},check:{enable:true},view:{showLine:false,addHoverDom:addHoverDom,removeHoverDom:removeHoverDom},callback:{onRightClick:onRightClick,onClick:onClick,onCheck:onCheck}};var zNodes=[{"id":RESOURCE_ROOT_ID,"name":"资源","parentId":-1,"open":false,"isParent":true,"iconSkin":"icon-resource-double"}];
$.fn.zTree.init($("#resourceZTree"),setting,zNodes);var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");var rootNode=resourceZTree.getNodeByParam("id",RESOURCE_ROOT_ID,null);resourceZTree.expandNode(rootNode,true,false,true);};var addHoverDom=function(treeId,treeNode){if(treeNode.id==RESOURCE_ROOT_ID){return;}if($("#"+treeNode.tId+"_operate").length>0){$("#"+treeNode.tId+"_operate").show();return;}var obj=$("#"+treeNode.tId+"_a");var _resource_operate_div="<div id='"+treeNode.tId+"_operate' class='resource_operate_div'>"+"<span class='resource_operate_checkbox resource_operate_checkbox_false_full'></span><span>增</span>"+"<span class='resource_operate_checkbox resource_operate_checkbox_false_full'></span><span>删</span>"+"<span class='resource_operate_checkbox resource_operate_checkbox_false_full'></span><span>改</span>"+"<span class='resource_operate_checkbox resource_operate_checkbox_false_full'></span><span>查</span></div>";
obj.append(_resource_operate_div);if(!($._data($("#"+treeNode.tId+"_operate .resource_operate_checkbox").get(0),"events")!=undefined&&$._data($("#"+treeNode.tId+"_operate .resource_operate_checkbox").get(0),"events")["click"]!=undefined)){$("#"+treeNode.tId+"_operate .resource_operate_checkbox").bind("click",function(){if(treeNode.checked&&!treeNode.getCheckStatus().half){if($(this).hasClass("resource_operate_checkbox_false_full")){$(this).removeClass("resource_operate_checkbox_false_full");$(this).addClass("resource_operate_checkbox_true_full");
}else{if($(this).hasClass("resource_operate_checkbox_true_full")){$(this).removeClass("resource_operate_checkbox_true_full");$(this).addClass("resource_operate_checkbox_false_full");}}}});}if(treeNode.checked&&!treeNode.getCheckStatus().half){if(saveRoleNode){var treeNodesData=roleView.getRoleResourceArr(saveRoleNode);if(treeNodesData){for(var i=0;i<treeNodesData.length;i++){if(treeNodesData[i].id==treeNode.id){resourcePermission(treeNode,treeNodesData[i].permission);}}}}}};var removeHoverDom=function(treeId,treeNode){if($("#"+treeNode.tId+"_operate").is(":visible")){$("#"+treeNode.tId+"_operate").hide();
}};var onClick=function(event,treeId,treeNode){var resourceZTree=$.fn.zTree.getZTreeObj(treeId);if(selectResourceNode){if(selectResourceNode.id==treeNode.id){return;}if(selectResourceNode.isParent){selectResourceNode.iconSkin="icon-resource-double";}else{selectResourceNode.iconSkin="icon-resource-single";}resourceZTree.updateNode(selectResourceNode);}selectResourceNode=treeNode;if(treeNode.isParent){treeNode.iconSkin="icon-resource-double-s";}else{treeNode.iconSkin="icon-resource-single-s";}resourceZTree.updateNode(treeNode);
};var onCheck=function(event,treeId,treeNode){if(!treeNode.checked){unResourcePermission(treeNode);unParentNodesPermission(treeNode,treeId);unChildrenNodesPermission(treeNode,treeId);}};var onRightClick=function(event,treeId,treeNode){showMenu(treeId,treeNode,event);};var showMenu=function(treeId,treeNode,event){if(treeNode){var resourceZTree=$.fn.zTree.getZTreeObj(treeId);resourceZTree.selectNode(treeNode);onClick(null,treeId,treeNode);var menuId="resource_menu";initMenu(resourceZTree,treeNode,menuId,event);
}};var resourcePermission=function(treeNode,permission){var obj=$("#"+treeNode.tId+"_a");if(obj.children(".resource_operate_div").length>0){var _checkboxes=obj.children(".resource_operate_div").children(".resource_operate_checkbox");permission=parseInt(permission,2);var temp=permission&8;if(temp==8){$(_checkboxes[0]).removeClass("resource_operate_checkbox_false_full");$(_checkboxes[0]).addClass("resource_operate_checkbox_true_full");}temp=permission&4;if(temp==4){$(_checkboxes[1]).removeClass("resource_operate_checkbox_false_full");
$(_checkboxes[1]).addClass("resource_operate_checkbox_true_full");}temp=permission&2;if(temp==2){$(_checkboxes[2]).removeClass("resource_operate_checkbox_false_full");$(_checkboxes[2]).addClass("resource_operate_checkbox_true_full");}temp=permission&1;if(temp==1){$(_checkboxes[3]).removeClass("resource_operate_checkbox_false_full");$(_checkboxes[3]).addClass("resource_operate_checkbox_true_full");}}};var unResourcePermission=function(treeNode){var obj=$("#"+treeNode.tId+"_a");if(obj.children(".resource_operate_div").length>0){var _checkboxes=obj.children(".resource_operate_div").children(".resource_operate_checkbox");
for(var i=0;i<_checkboxes.length;i++){if($(_checkboxes[i]).hasClass("resource_operate_checkbox_true_full")){$(_checkboxes[i]).removeClass("resource_operate_checkbox_true_full");$(_checkboxes[i]).addClass("resource_operate_checkbox_false_full");}}}};var getResourcePermission=function(treeNode){var obj=$("#"+treeNode.tId+"_a");var permission=0;if(obj.children(".resource_operate_div").length>0){var _checkboxes=obj.children(".resource_operate_div").children(".resource_operate_checkbox");var a=0,b=0,c=0,d=0;
if($(_checkboxes[0]).hasClass("resource_operate_checkbox_true_full")){a=8;}else{if($(_checkboxes[0]).hasClass("resource_operate_checkbox_false_full")){a=0;}}if($(_checkboxes[1]).hasClass("resource_operate_checkbox_true_full")){b=4;}else{if($(_checkboxes[1]).hasClass("resource_operate_checkbox_false_full")){b=0;}}if($(_checkboxes[2]).hasClass("resource_operate_checkbox_true_full")){c=2;}else{if($(_checkboxes[2]).hasClass("resource_operate_checkbox_false_full")){c=0;}}if($(_checkboxes[3]).hasClass("resource_operate_checkbox_true_full")){d=1;
}else{if($(_checkboxes[3]).hasClass("resource_operate_checkbox_false_full")){d=0;}}permission=parseInt(parseInt((a+b+c+d),10).toString(2));}else{if(saveRoleNode){var treeNodesData=roleView.getRoleResourceArr(saveRoleNode);for(var i=0;i<treeNodesData.length;i++){if(treeNodesData[i].id==treeNode.id){permission=treeNodesData[i].permission;break;}}}}return permission;};var unParentNodesPermission=function(treeNode,treeId){var parentNodes=new Array();getZTreeAllParentNodes(treeNode,treeId,RESOURCE_ROOT_ID,parentNodes);
for(var i=0;i<parentNodes.length;i++){unResourcePermission(parentNodes[i]);}};var unChildrenNodesPermission=function(treeNode,treeId){var childrenNodes=new Array();getZTreeAllChildrenNodes(treeNode,treeId,RESOURCE_ROOT_ID,childrenNodes);for(var i=0;i<childrenNodes.length;i++){unResourcePermission(childrenNodes[i]);}};this.init=function(){initResourceZTree();};this.addZTreeNode=function(data){var param={type:"add",data:JSON2.stringify(data)};resourceService.omOperateResource(appendResourceNode,param);
};this.updateZTreeNode=function(data){var param={type:"update",data:JSON2.stringify(data)};resourceService.omOperateResource(updateResourceNode,param);};this.deleteZTreeNode=function(treeNode){var param={type:"delete",data:JSON2.stringify({id:treeNode.id})};resourceService.omOperateResource(deleteResourceNode,param);};this.checkResourceNodes=function(treeNodesData,selectRoleNode){var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");for(var i=0;i<treeNodesData.length;i++){var treeNode=resourceZTree.getNodeByParam("id",treeNodesData[i].id);
resourceZTree.checkNode(treeNode,true,true,false);resourcePermission(treeNode,treeNodesData[i].permission);}this.setSaveRoleNode(selectRoleNode);};this.unCheckAllResourceNodes=function(){var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");var checkedNodes=resourceZTree.getCheckedNodes(true);for(var i=0;i<checkedNodes.length;i++){unResourcePermission(checkedNodes[i]);}resourceZTree.checkAllNodes(false);};this.omSearchResource=function(name){this.unOmSearchResource();var param={data:JSON2.stringify({name:name})};
resourceService.omSearchResource(showSearchResourceData,param);};this.unOmSearchResource=function(){if(searchResourceData&&searchResourceData.length>0){var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");for(var i=0;i<searchResourceData.length;i++){var treeNode=resourceZTree.getNodeByParam("id",searchResourceData[i].id);if(treeNode){$("#"+treeNode.tId+"_span").removeClass("search_node_color");}}}};this.omCheckNoIsExit=function(callBack,no){var param={data:JSON2.stringify({no:no})};resourceService.omCheckNoIsExit(function(ret){if(callBack){var flag=ret.returnFlag==0?true:false;
callBack(flag);}},param);};this.getChangeCheckedResourcesData=function(oldCheckedResourcesData){var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");var checkedNodes=resourceZTree.getCheckedNodes(true);var changeResourcesData=new Array();for(var i=0;i<checkedNodes.length;i++){if(checkedNodes[i].getCheckStatus().half){checkedNodes.splice(i,1);i--;}}if(oldCheckedResourcesData.length==0&&checkedNodes.length==0){return changeResourcesData;}if(oldCheckedResourcesData.length==0){for(var i=0;i<checkedNodes.length;
i++){var permission=getResourcePermission(checkedNodes[i]);var json={"id":checkedNodes[i].id,"type":0,"permission":permission};changeResourcesData.push(json);}}else{for(var i=0;i<checkedNodes.length;i++){for(var j=0;j<oldCheckedResourcesData.length;j++){var permission=getResourcePermission(checkedNodes[i]);if(checkedNodes[i].id==oldCheckedResourcesData[j].id){if(permission==oldCheckedResourcesData[j].permission){}else{var json={"id":checkedNodes[i].id,"type":0,"permission":permission};changeResourcesData.push(json);
}break;}if(j==oldCheckedResourcesData.length-1){var json={"id":checkedNodes[i].id,"type":0,"permission":permission};changeResourcesData.push(json);}}}}if(checkedNodes.length==0){for(var i=0;i<oldCheckedResourcesData.length;i++){var json={"id":oldCheckedResourcesData[i].id,"type":1};changeResourcesData.push(json);}}else{for(var i=0;i<oldCheckedResourcesData.length;i++){for(var j=0;j<checkedNodes.length;j++){if(oldCheckedResourcesData[i].id==checkedNodes[j].id){break;}if(j==checkedNodes.length-1){var json={"id":oldCheckedResourcesData[i].id,"type":1};
changeResourcesData.push(json);}}}}return changeResourcesData;};this.setSaveRoleNode=function(roleNode){saveRoleNode=roleNode;};}function RoleView(){var ROLE_ROOT_ID=0;var selectRoleNode=null;var roleService=new RoleService();var searchRoleData=null;var roleResourceData=new HashMap();var _roleView=this;var appendRoleNode=function(data,param){var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");var parentNode=roleZTree.getSelectedNodes()[0];var paramData=JSON2.parse(param.data);var checked=false;if(parentNode.checked&&!parentNode.getCheckStatus().half){checked=true;
}var newRoleNodes=[{"id":data,"name":paramData.name,"status":paramData.status,"parentId":parentNode.id,"iconSkin":"icon-role-single","checked":checked}];if(!parentNode.isParent){parentNode.iconSkin="icon-role-double-s";roleZTree.updateNode(parentNode);}roleZTree.addNodes(parentNode,newRoleNodes);$(".blackboard-css").hide();$("#renameWin").fadeOut(function(){$("#renameWin").remove();});};var updateRoleNode=function(data,param){var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");var selectNode=roleZTree.getSelectedNodes()[0];
var paramData=JSON2.parse(param.data);selectNode.name=paramData.name;roleZTree.updateNode(selectNode);$(".blackboard-css").hide();$("#renameWin").fadeOut(function(){$("#renameWin").remove();});};var deleteRoleNode=function(data,param){var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");var selectNode=roleZTree.getSelectedNodes()[0];var parentNode=selectNode.getParentNode();roleZTree.removeNode(selectNode);if(!parentNode.isParent){parentNode.iconSkin="icon-role-single";roleZTree.updateNode(parentNode);
}roleResourceData.remove(selectNode.id);resourceView.setSaveRoleNode(null);unCheckAllResourceNodes();selectRoleNode=null;$(".blackboard-css").hide();$("#deleteWin").fadeOut(function(){$("#deleteWin").remove();});};var showSearchRoleData=function(data){searchRoleData=data;if(data.length==0){$("#role_result_span_tip").show();}else{if(data.length>0){var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");for(var i=0;i<data.length;i++){var treeNode=roleZTree.getNodeByParam("id",data[i].id);if($("#"+treeNode.tId+"_a").length==0){roleZTree.selectNode(treeNode);
}$("#"+treeNode.tId+"_span").addClass("search_node_color");}if($("#role_operate").height()<$("#roleZTree").height()){$("#role_operate").scrollTop(0);}if(selectRoleNode){roleZTree.selectNode(selectRoleNode);}else{roleZTree.cancelSelectedNode();}}}};var checkResourceNodes=function(treeNode){var id=treeNode.id;if(id==ROLE_ROOT_ID){return;}if(roleResourceData.get(id)){resourceView.checkResourceNodes(roleResourceData.get(id),treeNode);}else{var param={data:JSON2.stringify({"id":id})};roleService.omGetRoleResource(function(data){resourceView.checkResourceNodes(data,treeNode);
roleResourceData.put(id,data);},param);}};var unCheckAllResourceNodes=function(){resourceView.unCheckAllResourceNodes();};var awardResource=function(param,isShowTip){var id=JSON2.parse(param.data).id;var paramData=JSON2.parse(param.data).value;var data=roleResourceData.get(id);for(var i=0;i<paramData.length;i++){if(paramData[i].type==0){if(data.length==0){var json={"id":paramData[i].id,"permission":paramData[i].permission};data.push(json);}else{for(var j=0;j<data.length;j++){if(paramData[i].id==data[j].id){data.splice(j,1);
var json={"id":paramData[i].id,"permission":paramData[i].permission};data.push(json);break;}if(j==data.length-1){var json={"id":paramData[i].id,"permission":paramData[i].permission};data.push(json);}}}}else{if(paramData[i].type==1){for(var j=0;j<data.length;j++){if(paramData[i].id==data[j].id){data.splice(j,1);break;}}}}}roleResourceData.remove(id);roleResourceData.put(id,data);if(isShowTip){$.messager.alert("操作提示","保存成功！","info");omTopView.removeOmsaveDisable();}};var initRoleZTree=function(){var setting={async:{enable:true,url:path+"/ts/omGetRoleZTree?",autoParam:["id"]},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId",rootPId:-1}},check:{enable:true},view:{showLine:false},callback:{onRightClick:onRightClick,onClick:onClick}};
var zNodes=[{"id":ROLE_ROOT_ID,"name":"角色","parentId":-1,"open":false,"isParent":true,"iconSkin":"icon-role-double"}];$.fn.zTree.init($("#roleZTree"),setting,zNodes);var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");var rootNode=roleZTree.getNodeByParam("id",ROLE_ROOT_ID,null);roleZTree.expandNode(rootNode,true,false,true);};var onClick=function(event,treeId,treeNode){var roleZTree=$.fn.zTree.getZTreeObj(treeId);if(selectRoleNode){if(selectRoleNode.id==treeNode.id){return;}if(selectRoleNode.isParent){selectRoleNode.iconSkin="icon-role-double";
}else{selectRoleNode.iconSkin="icon-role-single";}roleZTree.updateNode(selectRoleNode);omAwardResource(selectRoleNode);unCheckAllResourceNodes();}else{unCheckAllResourceNodes();}selectRoleNode=treeNode;if(treeNode.isParent){treeNode.iconSkin="icon-role-double-s";}else{treeNode.iconSkin="icon-role-single-s";}roleZTree.updateNode(treeNode);checkResourceNodes(treeNode);};var onRightClick=function(event,treeId,treeNode){showMenu(treeId,treeNode,event);};var showMenu=function(treeId,treeNode,event){if(treeNode){var roleZTree=$.fn.zTree.getZTreeObj(treeId);
roleZTree.selectNode(treeNode);onClick(null,treeId,treeNode);var menuId="role_menu";initMenu(roleZTree,treeNode,menuId,event);}};var omAwardResource=function(treeNode){var id=treeNode.id;if(id==ROLE_ROOT_ID){return;}var changeCheckedResourcesData=_roleView.getChangeCheckedResourceData(treeNode);if(changeCheckedResourcesData&&changeCheckedResourcesData.length>0){_roleView.saveRolePermission(treeNode,changeCheckedResourcesData,false);}};this.init=function(){initRoleZTree();};this.addZTreeNode=function(treeNode,name){var param={type:"add",data:JSON2.stringify({name:name,parentId:treeNode.id,status:1})};
roleService.omOperateRole(appendRoleNode,param);};this.updateZTreeNode=function(treeNode,name){var param={type:"update",data:JSON2.stringify({id:treeNode.id,name:name})};roleService.omOperateRole(updateRoleNode,param);};this.deleteZTreeNode=function(treeNode){var param={type:"delete",data:JSON2.stringify({id:treeNode.id})};roleService.omOperateRole(deleteRoleNode,param);};this.omSearchRole=function(name){this.unOmSearchRole();var param={data:JSON2.stringify({name:name})};roleService.omSearchRole(showSearchRoleData,param);
};this.unOmSearchRole=function(){if(searchRoleData&&searchRoleData.length>0){var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");for(var i=0;i<searchRoleData.length;i++){var treeNode=roleZTree.getNodeByParam("id",searchRoleData[i].id);if(treeNode){$("#"+treeNode.tId+"_span").removeClass("search_node_color");}}}};this.checkRoleNodes=function(treeNodesData){var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");for(var i=0;i<treeNodesData.length;i++){var treeNode=roleZTree.getNodeByParam("id",treeNodesData[i].id);
roleZTree.checkNode(treeNode,true,true,false);}};this.getRoleResourceArr=function(treeNode){if(treeNode){return roleResourceData.get(treeNode.id);}else{return null;}};this.unCheckAllRoleNodes=function(){var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");roleZTree.checkAllNodes(false);};this.getChangeCheckedRolesData=function(oldCheckedRolesData){var roleZTree=$.fn.zTree.getZTreeObj("roleZTree");var checkedNodes=roleZTree.getCheckedNodes(true);var changeRolesData=new Array();for(var i=0;i<checkedNodes.length;
i++){if(checkedNodes[i].getCheckStatus().half){checkedNodes.splice(i,1);i--;}}if(oldCheckedRolesData.length==0&&checkedNodes.length==0){return changeRolesData;}if(oldCheckedRolesData.length==0){for(var i=0;i<checkedNodes.length;i++){var json={"id":checkedNodes[i].id,"type":0};changeRolesData.push(json);}}else{for(var i=0;i<checkedNodes.length;i++){for(var j=0;j<oldCheckedRolesData.length;j++){if(checkedNodes[i].id==oldCheckedRolesData[j].id){break;}if(j==oldCheckedRolesData.length-1){var json={"id":checkedNodes[i].id,"type":0};
changeRolesData.push(json);}}}}if(checkedNodes.length==0){for(var i=0;i<oldCheckedRolesData.length;i++){var json={"id":oldCheckedRolesData[i].id,"type":1};changeRolesData.push(json);}}else{for(var i=0;i<oldCheckedRolesData.length;i++){for(var j=0;j<checkedNodes.length;j++){if(oldCheckedRolesData[i].id==checkedNodes[j].id){break;}if(j==checkedNodes.length-1){var json={"id":oldCheckedRolesData[i].id,"type":1};changeRolesData.push(json);}}}}return changeRolesData;};this.getChangeCheckedResourceData=function(treeNode){var id=treeNode.id;
if(id==ROLE_ROOT_ID){return;}var oldCheckedResourcesData=roleResourceData.get(id);var changeCheckedResourcesData=new Array();if(oldCheckedResourcesData){changeCheckedResourcesData=resourceView.getChangeCheckedResourcesData(oldCheckedResourcesData);}return changeCheckedResourcesData;};this.saveRolePermission=function(treeNode,changeCheckedResourcesData,isShowTip){var id=treeNode.id;var param={"data":JSON2.stringify({"id":id,"value":changeCheckedResourcesData})};roleService.omAwardResource(awardResource,param,isShowTip);
};}function WindowView(){var _windowView=this;var USER_TYPE=1;var ORGANIZATION_TYPE=0;var renameOperateType;var renameTreeId;var deleteOperateType;var deleteTreeId;var newResourceOperateType;var newOrganizationOperateType;var newUserOperateType;var changeUserArray;var allUserData=null;var relieveOrganizationArray;this.initRenameWin=function(treeId,operateType){renameOperateType=operateType;renameTreeId=treeId;var zTree=$.fn.zTree.getZTreeObj(treeId);var selectNode=zTree.getSelectedNodes()[0];$(".blackboard-css").show();
var json=null;if(renameTreeId=="organizationZTree"){if(renameOperateType=="rename"){if(selectNode.type==USER_TYPE){json={"win_title":"重命名用户","renameInput_title":"用户名称：","name":selectNode.name,"defaultValue":selectNode.name};}else{if(selectNode.type==ORGANIZATION_TYPE){json={"win_title":"重命名组织","renameInput_title":"组织名称：","name":selectNode.name,"defaultValue":selectNode.name};}}}}else{if(renameTreeId=="roleZTree"){if(renameOperateType=="new"){json={"win_title":"新增角色","renameInput_title":"角色名称：","name":"角色名称","defaultValue":"角色名称"};
}else{if(renameOperateType=="rename"){json={"win_title":"重命名角色","renameInput_title":"角色名称：","name":selectNode.name,"defaultValue":selectNode.name};}}}}$("body").append($.render($("#renameWin_template").html(),json));$("#renameWin").fadeIn();$("#renameWin").draggable({handle:$("#renameWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#renameWin .textInput").get(0),"events")!=undefined&&$._data($("#renameWin .textInput").get(0),"events")["focus"]!=undefined)){$("#renameWin .textInput").bind("focus",function(){if(renameOperateType=="new"){if(isHintInputEmpty($(this))){$(this).val("");
$(this).removeClass("input_hint");$(this).addClass("input_normal");}}$(this).removeClass("textInput-n");$(this).addClass("textInput-f");$("#renameSaveBtn").removeAttr("disabled");$("#renameInput_error_tip").hide();});$("#renameWin .textInput").bind("blur",function(){if(renameOperateType=="new"){var defaultValue=$(this).attr("defaultValue");if($.trim($(this).val())==""){$(this).val(defaultValue);$(this).removeClass("input_normal");$(this).addClass("input_hint");}}else{if(renameOperateType="rename"){renameInputSubmitState();
}}});}if(renameOperateType=="new"){$("#renameWin .textInput").addClass("input_hint");$("#renameInput").focus();}else{if(renameOperateType=="rename"){$("#renameWin .textInput").addClass("input_normal");$("#renameInput").select();}}if(!($._data($("#renameSaveBtn").get(0),"events")!=undefined&&$._data($("#renameSaveBtn").get(0),"events")["click"]!=undefined)){$("#renameSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;}else{$(this).attr("disabled",true);}var zTree=$.fn.zTree.getZTreeObj(renameTreeId);
var selectNode=zTree.getSelectedNodes()[0];var name=$.trim($("#renameInput").val());if(renameOperateType=="new"){if(isHintInputEmpty($("#renameInput"))){$("#renameInput_error_tip").text("新增角色名称不能为空");$("#renameInput_error_tip").show();return;}roleView.addZTreeNode(selectNode,name);}else{if(renameOperateType=="rename"){if(renameInputSubmitState()){return;}if(name==$.trim($("#renameInput").attr("defaultvalue"))){$(".blackboard-css").hide();$("#renameWin").fadeOut(function(){$("#renameWin").remove();
});}else{if(renameTreeId=="organizationZTree"){organizationView.renameZTreeNode(selectNode,name);}else{if(renameTreeId="roleZTree"){roleView.updateZTreeNode(selectNode,name);}}}}}});}function renameInputSubmitState(){if($.trim($("#renameInput").val())==""){var error="";if(renameTreeId=="organizationZTree"){if(selectNode.type==USER_TYPE){error="重命名用户名称不能为空";}else{if(selectNode.type==ORGANIZATION_TYPE){error="重命名组织名称不能为空";}}}else{if(renameTreeId="roleZTree"){error="重命名角色名称不能为空";}}$("#renameInput_error_tip").text(error);
$("#renameInput_error_tip").show();return true;}return false;}if(!($._data($("#renameCancelBtn").get(0),"events")!=undefined&&$._data($("#renameCancelBtn").get(0),"events")["click"]!=undefined)){$("#renameCancelBtn").bind("click",function(){$(".blackboard-css").hide();$("#renameWin").fadeOut(function(){$("#renameWin").remove();});});}if(!($._data($("#renameWin .win_close").get(0),"events")!=undefined&&$._data($("#renameWin .win_close").get(0),"events")["click"]!=undefined)){$("#renameWin .win_close").bind("click",function(){$(".blackboard-css").hide();
$("#renameWin").fadeOut(function(){$("#renameWin").remove();});});}};this.initNewResourceWin=function(operateType){newResourceOperateType=operateType;var json=null;var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");var selectNode=resourceZTree.getSelectedNodes()[0];if(newResourceOperateType=="new"){json={win_title:"新增资源",name:"资源名称",nameDefaultValue:"资源名称",no:"资源编号",noDefaultValue:"资源编号"};}else{if(newResourceOperateType=="rename"){var name=selectNode.name.substring(0,selectNode.name.lastIndexOf("("+selectNode.no+")"));
json={win_title:"编辑资源",name:name,nameDefaultValue:name,no:selectNode.no,noDefaultValue:selectNode.no};}}$("body").append($.render($("#newResourceWin_template").html(),json));$(".blackboard-css").show();$("#newResourceWin").fadeIn();$("#newResourceWin").draggable({handle:$("#newResourceWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#newResourceWin .textInput").get(0),"events")!=undefined&&$._data($("#newResourceWin .textInput").get(0),"events")["focus"]!=undefined)){$("#newResourceWin .textInput").bind("focus",function(){if(newResourceOperateType=="new"){if(isHintInputEmpty($(this))){$(this).val("");
$(this).removeClass("input_hint");$(this).addClass("input_normal");}}$(this).removeClass("textInput-n");$(this).addClass("textInput-f");$("#newResourceSaveBtn").removeAttr("disabled");$("#"+this.id+"_error_tip").hide();});$("#newResourceWin .textInput").bind("blur",function(){var defaultValue=$(this).attr("defaultValue");var value=$.trim($(this).val());if(newResourceOperateType=="new"){if(value==""){$(this).val(defaultValue);$(this).removeClass("input_normal");$(this).addClass("input_hint");}else{if(this.id=="resourceNoInput"){resourceView.omCheckNoIsExit(function(flag){if(!flag){$("#resourceNoInput_error_tip").text("该资源编号已存在！");
$("#resourceNoInput_error_tip").show();}},value);}}}else{if(newResourceOperateType=="rename"){if(value==""){newResourceInputSubmitEmpty(this);}else{if(this.id=="resourceNoInput"&&value!=$(this).attr("defaultValue")){resourceView.omCheckNoIsExit(function(flag){if(!flag){$("#resourceNoInput_error_tip").text("该资源编号已存在！");$("#resourceNoInput_error_tip").show();}},value);}}}}});}if(newResourceOperateType=="new"){$("#newResourceWin .textInput").addClass("input_hint");$("#resourceNameInput").focus();}else{if(newResourceOperateType=="rename"){$("#renameWin .textInput").addClass("input_normal");
$("#resourceNameInput").select();}}if(!($._data($("#newResourceSaveBtn").get(0),"events")!=undefined&&$._data($("#newResourceSaveBtn").get(0),"events")["click"]!=undefined)){$("#newResourceSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;}else{$(this).attr("disabled",true);}var hasErr=false;var name=$.trim($("#resourceNameInput").val());var oldName=$("#resourceNameInput").attr("defaultValue");var no=$.trim($("#resourceNoInput").val());var oldNo=$("#resourceNoInput").attr("defaultValue");
var resourceZTree=$.fn.zTree.getZTreeObj("resourceZTree");var selectNode=resourceZTree.getSelectedNodes()[0];var data={};if(newResourceOperateType=="new"){$("#newResourceWin .textInput").each(function(){if(isHintInputEmpty($(this))){var error="";if(this.id=="resourceNameInput"){error="资源名称不能为空！";}else{if(this.id=="resourceNoInput"){error="资源编号不能为空！";}}$("#"+this.id+"_error_tip").text(error);$("#"+this.id+"_error_tip").show();hasErr=true;}});if(!hasErr){resourceView.omCheckNoIsExit(function(flag){if(!flag){$("#resourceNoInput_error_tip").text("该资源编号已存在！");
$("#resourceNoInput_error_tip").show();}else{data["name"]=name;data["no"]=no;data["status"]=1;data["parentId"]=selectNode.id;resourceView.addZTreeNode(data);}},no);}}else{if(newResourceOperateType=="rename"){$("#newResourceWin .textInput").each(function(){if($.trim($(this).val())==""){newResourceInputSubmitEmpty(this);hasErr=true;}});if(!hasErr){if(name==oldName&&no==oldNo){$(".blackboard-css").hide();$("#newResourceWin").fadeOut(function(){$("#newResourceWin").remove();});}else{if(no==oldNo){data["id"]=selectNode.id;
data["name"]=name;data["no"]=no;resourceView.updateZTreeNode(data);}else{resourceView.omCheckNoIsExit(function(flag){if(!flag){$("#resourceNoInput_error_tip").text("该资源编号已存在！");$("#resourceNoInput_error_tip").show();}else{data["id"]=selectNode.id;data["name"]=name;data["no"]=no;resourceView.updateZTreeNode(data);}},no);}}}}}});}function newResourceInputSubmitEmpty(_this){var error="";if(_this.id=="resourceNameInput"){error="资源名称不能为空！";}else{if(_this.id=="resourceNoInput"){error="资源编号不能为空！";}}$("#"+_this.id+"_error_tip").text(error);
$("#"+_this.id+"_error_tip").show();}if(!($._data($("#newResourceCancelBtn").get(0),"events")!=undefined&&$._data($("#newResourceCancelBtn").get(0),"events")["click"]!=undefined)){$("#newResourceCancelBtn").bind("click",function(){$(".blackboard-css").hide();$("#newResourceWin").fadeOut(function(){$("#newResourceWin").remove();});});}if(!($._data($("#newResourceWin .win_close").get(0),"events")!=undefined&&$._data($("#newResourceWin .win_close").get(0),"events")["click"]!=undefined)){$("#newResourceWin .win_close").bind("click",function(){$(".blackboard-css").hide();
$("#newResourceWin").fadeOut(function(){$("#newResourceWin").remove();});});}};this.initDeleteWin=function(treeId,operateType){deleteOperateType=operateType;deleteTreeId=treeId;var zTree=$.fn.zTree.getZTreeObj(treeId);var selectNode=zTree.getSelectedNodes()[0];var parentNode=selectNode.getParentNode();var deleteContent="";var json=null;switch(deleteTreeId){case"organizationZTree":if(deleteOperateType=="delete"){if(selectNode.type==ORGANIZATION_TYPE){deleteContent="确认删除名为【"+selectNode.name+"】的组织？";
json={win_title:"删除",win_delte_content:deleteContent};}else{if(selectNode.type==USER_TYPE){deleteContent="确认删除名为【"+selectNode.name+"】的用户？";json={win_title:"删除",win_delte_content:deleteContent};}}}else{if(deleteOperateType=="relieve"){deleteContent="确认删除名为【"+selectNode.name+"】的用户与上级组织【"+parentNode.name+"】间的关系?";json={win_title:"解除关系",win_delte_content:deleteContent};}}break;case"roleZTree":deleteContent="确认删除名为【"+selectNode.name+"】的角色？";json={win_title:"删除",win_delte_content:deleteContent};break;case"resourceZTree":var name=selectNode.name.substring(0,selectNode.name.lastIndexOf("("+selectNode.no+")"));
deleteContent="确认删除名为【"+name+"】的资源？";json={win_title:"删除",win_delte_content:deleteContent};break;}$("body").append($.render($("#deleteWin_template").html(),json));$(".blackboard-css").show();$("#deleteWin").fadeIn();$("#deleteWin").draggable({handle:$("#deleteWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#deleteSaveBtn").get(0),"events")!=undefined&&$._data($("#deleteSaveBtn").get(0),"events")["click"]!=undefined)){$("#deleteSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;
}else{$(this).attr("disabled",true);}var zTree=$.fn.zTree.getZTreeObj(deleteTreeId);var selectNode=zTree.getSelectedNodes()[0];var parentNode=selectNode.getParentNode();switch(deleteTreeId){case"organizationZTree":if(deleteOperateType=="delete"){organizationView.deleteZTreeNode(selectNode);}else{if(deleteOperateType=="relieve"){organizationView.relieveRelatZTreeNode(selectNode,parentNode);}}break;case"roleZTree":roleView.deleteZTreeNode(selectNode);break;case"resourceZTree":resourceView.deleteZTreeNode(selectNode);
break;}});}if(!($._data($("#deleteCancelBtn").get(0),"events")!=undefined&&$._data($("#deleteCancelBtn").get(0),"events")["click"]!=undefined)){$("#deleteCancelBtn").bind("click",function(){$(".blackboard-css").hide();$("#deleteWin").fadeOut(function(){$("#deleteWin").remove();});});}if(!($._data($("#deleteWin .win_close").get(0),"events")!=undefined&&$._data($("#deleteWin .win_close").get(0),"events")["click"]!=undefined)){$("#deleteWin .win_close").bind("click",function(){$(".blackboard-css").hide();
$("#deleteWin").fadeOut(function(){$("#deleteWin").remove();});});}};this.initNewChooseWin=function(){$(".blackboard-css").show();$("body").append($("#newChooseWin_template").html());$("#newChooseWin").fadeIn();$("#newChooseWin").draggable({handle:$("#newChooseWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#newChooseWin .hugeButton_01").get(0),"events")!=undefined&&$._data($("#newChooseWin .hugeButton_01").get(0),"events")["click"]!=undefined)){$("#newChooseWin .hugeButton_01").bind("click",function(){var id=this.id;
if(id=="chooseNewOrganization"){$("#newChooseWin").fadeOut(function(){$("#newChooseWin").remove();});initNewSimpleOrganizationWin();}else{if(id=="chooseNewUser"){$("#newChooseWin").fadeOut(function(){$("#newChooseWin").remove();});initNewSimpleUserWin();}}});}if(!($._data($("#newChooseWin .win_close").get(0),"events")!=undefined&&$._data($("#newChooseWin .win_close").get(0),"events")["click"]!=undefined)){$("#newChooseWin .win_close").bind("click",function(){$(".blackboard-css").hide();$("#newChooseWin").fadeOut(function(){$("#newChooseWin").remove();
});});}};var initNewSimpleOrganizationWin=function(){$("body").append($("#newSimpleOrganizationWin_template").html());$("#newSimpleOrganizationWin").fadeIn();$("#newSimpleOrganizationWin").draggable({handle:$("#newSimpleOrganizationWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#newSimpleOrganizationWin .textInput").get(0),"events")!=undefined&&$._data($("#newSimpleOrganizationWin .textInput").get(0),"events")["focus"]!=undefined)){$("#newSimpleOrganizationWin .textInput").bind("focus",function(){if(isHintInputEmpty($(this))){$(this).val("");
$(this).removeClass("input_hint");$(this).addClass("input_normal");}$(this).removeClass("textInput-n");$(this).addClass("textInput-f");$("#newSimpleOrganizationSaveBtn").removeAttr("disabled");$("#newSimpleOrganizationName_error_tip").hide();});$("#newSimpleOrganizationWin .textInput").bind("blur",function(){var defaultValue=$(this).attr("defaultValue");if($.trim($(this).val())==""){$(this).val(defaultValue);$(this).removeClass("input_normal");$(this).addClass("input_hint");}});}$("#newSimpleOrganizationName").focus();
if(!($._data($("#newSimpleOrganizationSaveBtn").get(0),"events")!=undefined&&$._data($("#newSimpleOrganizationSaveBtn").get(0),"events")["click"]!=undefined)){$("#newSimpleOrganizationSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;}else{$(this).attr("disabled",true);}if(isHintInputEmpty($("#newSimpleOrganizationName"))){$("#newSimpleOrganizationName_error_tip").text("组织名称不能为空！");$("#newSimpleOrganizationName_error_tip").show();return;}var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");
var selectNode=organizationZTree.getSelectedNodes()[0];var name=$.trim($("#newSimpleOrganizationName").val());var data={};data["parentId"]=selectNode.id;data["type"]=ORGANIZATION_TYPE;data["status"]=1;data["name"]=name;organizationView.addZTreeNode(data,"newSimpleOrganizationWin");});}if(!($._data($("#newSimpleOrganizationAddMoreBtn").get(0),"events")!=undefined&&$._data($("#newSimpleOrganizationAddMoreBtn").get(0),"events")["click"]!=undefined)){$("#newSimpleOrganizationAddMoreBtn").bind("click",function(){var name;
var data;if(isHintInputEmpty($("#newSimpleOrganizationName"))){name=null;}else{name=$.trim($("#newSimpleOrganizationName").val());}data={name:name};$("#newSimpleOrganizationWin").fadeOut(function(){$("#newSimpleOrganizationWin").remove();});initNewDetailOrganizationWin(data,"new");});}if(!($._data($("#newSimpleOrganizationCancelBtn").get(0),"events")!=undefined&&$._data($("#newSimpleOrganizationCancelBtn").get(0),"events")["click"]!=undefined)){$("#newSimpleOrganizationCancelBtn").bind("click",function(){$(".blackboard-css").hide();
$("#newSimpleOrganizationWin").fadeOut(function(){$("#newSimpleOrganizationWin").remove();});});}if(!($._data($("#newSimpleOrganizationWin .win_close").get(0),"events")!=undefined&&$._data($("#newSimpleOrganizationWin .win_close").get(0),"events")["click"]!=undefined)){$("#newSimpleOrganizationWin .win_close").bind("click",function(){$(".blackboard-css").hide();$("#newSimpleOrganizationWin").fadeOut(function(){$("#newSimpleOrganizationWin").remove();});});}};var initNewDetailOrganizationWin=function(data,operateType){newOrganizationOperateType=operateType;
var json=null;if(newOrganizationOperateType=="new"){var name;var nameClass;if(data&&data.name){name=data.name;nameClass="input_normal";}else{name="组织名称";nameClass="input_hint";}json={win_title:"新增组织",name:name,nameClass:nameClass,nameDefaultValue:"组织名称",email:"电子邮箱",emailDefaultValue:"电子邮箱",phone:"电话",phoneDefaultValue:"电话",mobilePhone:"手机",mobilePhoneDefaultValue:"手机",address:"地址",addressDefaultValue:"地址"};}else{if(newOrganizationOperateType=="update"){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");
var selectNode=organizationZTree.getSelectedNodes()[0];json={win_title:"详细信息",name:selectNode.name,nameDefaultValue:selectNode.name,email:selectNode.email,emailDefaultValue:selectNode.email,phone:selectNode.phone,phoneDefaultValue:selectNode.phone,phoneDefaultValue:selectNode.phone,mobilePhone:selectNode.mobilePhone,mobilePhoneDefaultValue:selectNode.mobilePhoneDefaultValue,address:selectNode.address,addressDefaultValue:selectNode.address};}}$(".blackboard-css").show();$("body").append($.render($("#newDetailOrganizationWin_template").html(),json));
$("#newDetailOrganizationWin").fadeIn();$("#newDetailOrganizationWin").draggable({handle:$("#newDetailOrganizationWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#newDetailOrganizationWin .textInput").get(0),"events")!=undefined&&$._data($("#newDetailOrganizationWin .textInput").get(0),"events")["focus"]!=undefined)){$("#newDetailOrganizationWin .textInput").bind("focus",function(){if(newOrganizationOperateType=="new"){if(isHintInputEmpty($(this))){$(this).val("");$(this).removeClass("input_hint");
$(this).addClass("input_normal");}}$(this).removeClass("textInput-n");$(this).addClass("textInput-f");$("#newDetailOrganizationSaveBtn").removeAttr("disabled");$("#"+this.id+"_error_tip").hide();});$("#newDetailOrganizationWin .textInput").bind("blur",function(){$(this).removeClass("textInput-f");$(this).addClass("textInput-n");if(newOrganizationOperateType=="new"){var defaultValue=$(this).attr("defaultValue");if($.trim($(this).val())==""){$(this).val(defaultValue);$(this).removeClass("input_normal");
$(this).addClass("input_hint");}else{validateInputErr(this.id,"new");}}else{if(newOrganizationOperateType=="update"){validateInputErr(this.id,"update");}}});}if(newOrganizationOperateType=="new"&&!(data&&data.name)){$("#newDetailOrganizationName").focus();}else{var tempName=$("#newDetailOrganizationName").val();$("#newDetailOrganizationName").val("").focus().val(tempName);}if(newOrganizationOperateType=="update"){$("#newDetailOrganizationWin .textInput").removeClass("input_hint");$("#newDetailOrganizationWin .textInput").addClass("input_normal");
}if(!($._data($("#newDetailOrganizationSaveBtn").get(0),"events")!=undefined&&$._data($("#newDetailOrganizationSaveBtn").get(0),"events")["click"]!=undefined)){$("#newDetailOrganizationSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;}else{$(this).attr("disabled",true);}var hasErr=false;var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];if(newOrganizationOperateType=="new"){if(isHintInputEmpty($("#newDetailOrganizationName"))){hasErr=true;
$("#newDetailOrganizationName_error_tip").text("组织名称不能为空");$("#newDetailOrganizationName_error_tip").show();}$("#newDetailOrganizationWin .textInput").each(function(){if(validateInputErr(this.id,"new")){hasErr=true;}});if(!hasErr){var name=$.trim($("#newDetailOrganizationName").val());var email=isHintInputEmpty($("#newDetailOrganizationEmail"))?"":$.trim($("#newDetailOrganizationEmail").val());var phone=isHintInputEmpty($("#newDetailOrganizationPhone"))?"":$.trim($("#newDetailOrganizationPhone").val());
var mobilePhone=isHintInputEmpty($("#newDetailOrganizationMobilePhone"))?"":$.trim($("#newDetailOrganizationMobilePhone").val());var address=isHintInputEmpty($("#newDetailOrganizationAddress"))?"":$.trim($("#newDetailOrganizationAddress").val());var data={};data["parentId"]=selectNode.id;data["type"]=ORGANIZATION_TYPE;data["status"]=1;data["name"]=name;data["email"]=email;data["phone"]=phone;data["mobilePhone"]=mobilePhone;data["address"]=address;organizationView.addZTreeNode(data,"newDetailOrganizationWin");
}}else{if(newOrganizationOperateType=="update"){$("#newDetailOrganizationWin .textInput").each(function(){if(validateInputErr(this.id,"update")){hasErr=true;}});if(!hasErr){var name=$.trim($("#newDetailOrganizationName").val());var email=$.trim($("#newDetailOrganizationEmail").val());var phone=$.trim($("#newDetailOrganizationPhone").val());var mobilePhone=$.trim($("#newDetailOrganizationMobilePhone").val());var address=$.trim($("#newDetailOrganizationAddress").val());var defaultName=$("#newDetailOrganizationName").attr("defaultvalue");
var defaultEmail=$("#newDetailOrganizationEmail").attr("defaultvalue");var defaultPhone=$("#newDetailOrganizationPhone").attr("defaultvalue");var defaultMobilePhone=$("#newDetailOrganizationMobilePhone").attr("defaultvalue");var defaultAddress=$("#newDetailOrganizationAddress").attr("defaultvalue");if(name==defaultName&&email==defaultEmail&&phone==defaultPhone&&mobilePhone==defaultMobilePhone&&address==defaultAddress){$(".blackboard-css").hide();$("#newDetailOrganizationWin").fadeOut(function(){$("#newDetailOrganizationWin").remove();
});return;}var data={id:selectNode.id,name:name,type:selectNode.type,email:email,phone:phone,mobilePhone:mobilePhone,address:address};organizationView.updateZTreeNode(selectNode,data,"newDetailOrganizationWin");}}}});}if(!($._data($("#newDetailOrganizationCancelBtn").get(0),"events")!=undefined&&$._data($("#newDetailOrganizationCancelBtn").get(0),"events")["click"]!=undefined)){$("#newDetailOrganizationCancelBtn").bind("click",function(){$(".blackboard-css").hide();$("#newDetailOrganizationWin").fadeOut(function(){$("#newDetailOrganizationWin").remove();
});});}if(!($._data($("#newDetailOrganizationWin .win_close").get(0),"events")!=undefined&&$._data($("#newDetailOrganizationWin .win_close").get(0),"events")["click"]!=undefined)){$("#newDetailOrganizationWin .win_close").bind("click",function(){$(".blackboard-css").hide();$("#newDetailOrganizationWin").fadeOut(function(){$("#newDetailOrganizationWin").remove();});});}function validateInputErr(id,type){var returnFlag=false;var validateType=$("#"+id).attr("validateType");var validateTypeArr=null;if(validateType){validateTypeArr=validateType.split(",");
}if(validateTypeArr){var _tip="";var value=$.trim($("#"+id).val());var isEmpty=false;if(type=="new"){isEmpty=isHintInputEmpty($("#"+id));}else{if(type=="update"){isEmpty=value==""?true:false;}}for(var i=0;i<validateTypeArr.length;i++){if(isEmpty){if(type=="update"&&validateTypeArr[i]=="required"){if(id=="newDetailOrganizationName"){_tip="组织名称不能为空！";}}}else{if(validateTypeArr[i]=="email"){if(!validateRules.isEmail(value)){_tip="请输入正确的电子邮箱地址！";}}else{if(validateTypeArr[i]=="phone"){if(!validateRules.isPhone(value)){_tip="请输入正确的电话号码！";
}}else{if(validateTypeArr[i]=="mobilePhone"){if(!validateRules.isMobilePhone(value)){_tip="请输入正确的手机号码！";}}}}}if(_tip!=""){$("#"+id+"_error_tip").show();$("#"+id+"_error_tip").text(_tip);returnFlag=true;break;}}}return returnFlag;}};function initNewSimpleUserWin(){var initJson={};if(useUserName){initJson["emailTitle"]="用户名：";initJson["email"]="用户名";initJson["emailDefaultValue"]="用户名";}else{initJson["emailTitle"]="电子邮箱：";initJson["email"]="电子邮箱";initJson["emailDefaultValue"]="电子邮箱";}var _newSimpleUserWin=$.render($("#newSimpleUserWin_template").html(),initJson);
$("body").append(_newSimpleUserWin);$("#newSimpleUserWin").fadeIn();$("#newSimpleUserWin").draggable({handle:$("#newSimpleUserWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#newSimpleUserWin .textInput").get(0),"events")!=undefined&&$._data($("#newSimpleUserWin .textInput").get(0),"events")["focus"]!=undefined)){$("#newSimpleUserWin .textInput").bind("focus",function(){if(this.id=="newSimpleUserPasswordTip"){$(this).hide();$("#newSimpleUserPassword").show();$("#newSimpleUserPassword").focus();
}else{if(this.id=="newSimpleUserPassword"){$(this).removeClass("textInput-n");$(this).addClass("textInput-f");$("#"+this.id+"_error_tip").hide();}else{if(isHintInputEmpty($(this))){$(this).val("");$(this).removeClass("input_hint");$(this).addClass("input_normal");}$(this).removeClass("textInput-n");$(this).addClass("textInput-f");$("#"+this.id+"_error_tip").hide();}}$("#newSimpleUserSaveBtn").removeAttr("disabled");});$("#newSimpleUserWin .textInput").bind("blur",function(){var defaultValue=$(this).attr("defaultValue");
$(this).removeClass("textInput-f");$(this).addClass("textInput-n");if($.trim($(this).val())==""){if(this.id=="newSimpleUserPassword"){$(this).hide();$("#newSimpleUserPasswordTip").show();}else{$(this).val(defaultValue);$(this).removeClass("input_normal");$(this).addClass("input_hint");}}else{if(!validateInputErr(this.id)){if(this.id=="newSimpleUserEmail"){var email=$("#"+this.id).val();organizationView.omUserIsExit(email,function(response){if(response.returnFlag=="-1"){if(useUserName){$("#newSimpleUserEmail_error_tip").text("用户名重复，请重新输入！");
}else{$("#newSimpleUserEmail_error_tip").text("电子邮箱地址重复，请重新输入！");}$("#newSimpleUserEmail_error_tip").show();}});}}}});}$("#newSimpleUserEmail").focus();if(!($._data($("#newSimpleUserSaveBtn").get(0),"events")!=undefined&&$._data($("#newSimpleUserSaveBtn").get(0),"events")["click"]!=undefined)){$("#newSimpleUserSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;}else{$(this).attr("disabled",true);}var hasErr=false;var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");
var selectNode=organizationZTree.getSelectedNodes()[0];$("#newSimpleUserWin .textInput").each(function(){var _tip="";if(this.id=="newSimpleUserPasswordTip"){if($(this).is(":visible")){_tip="密码不能为空！";hasErr=true;$("#newSimpleUserPassword_error_tip").text(_tip);$("#newSimpleUserPassword_error_tip").show();}}else{if(this.id=="newSimpleUserPassword"){if($(this).is(":visible")){if(validateInputErr(this.id)){hasErr=true;}}}else{if(isHintInputEmpty($(this))){switch(this.id){case"newSimpleUserEmail":if(useUserName){_tip="用户名不能为空！";
}else{_tip="电子邮箱不能为空！";}break;case"newSimpleUserName":_tip="姓名不能为空！";break;}hasErr=true;$("#"+this.id+"_error_tip").text(_tip);$("#"+this.id+"_error_tip").show();}if(validateInputErr(this.id)){hasErr=true;}}}});if(!hasErr){var email=$.trim($("#newSimpleUserEmail").val());var password=$.trim($("#newSimpleUserPassword").val());var name=$.trim($("#newSimpleUserName").val());var data={};data["parentId"]=selectNode.id;data["type"]=USER_TYPE;data["status"]=1;data["email"]=email;data["password"]=password;
data["name"]=name;organizationView.omUserIsExit(email,function(response){if(response.returnFlag=="0"){organizationView.addZTreeNode(data,"newSimpleUserWin");}else{if(useUserName){$("#newSimpleUserEmail_error_tip").text("用户名重复，请重新输入！");}else{$("#newSimpleUserEmail_error_tip").text("电子邮箱地址重复，请重新输入！");}$("#newSimpleUserEmail_error_tip").show();}});}});}if(!($._data($("#newSimpleUserAddMoreBtn").get(0),"events")!=undefined&&$._data($("#newSimpleUserAddMoreBtn").get(0),"events")["click"]!=undefined)){$("#newSimpleUserAddMoreBtn").bind("click",function(){var email=getValue($("#newSimpleUserEmail"));
var password=getPassword();var name=getValue($("#newSimpleUserName"));var data={email:email,password:password,name:name};initNewDetailUserWin(data,"new");$("#newSimpleUserWin").fadeOut(function(){$("#newSimpleUserWin").remove();});function getValue(_input){var value;if(isHintInputEmpty(_input)){value=null;}else{value=$.trim(_input.val());}return value;}function getPassword(){var value=null;if($("#newSimpleUserPasswordTip").is(":visible")){value=null;}else{if($("#newSimpleUserPassword").is(":visible")){value=$.trim($("#newSimpleUserPassword").val());
}}return value;}});}if(!($._data($("#newSimpleUserCancelBtn").get(0),"events")!=undefined&&$._data($("#newSimpleUserCancelBtn").get(0),"events")["click"]!=undefined)){$("#newSimpleUserCancelBtn").bind("click",function(){$(".blackboard-css").hide();$("#newSimpleUserWin").fadeOut(function(){$("#newSimpleUserWin").remove();});});}if(!($._data($("#newSimpleUserWin .win_close").get(0),"events")!=undefined&&$._data($("#newSimpleUserWin .win_close").get(0),"events")["click"]!=undefined)){$("#newSimpleUserWin .win_close").bind("click",function(){$(".blackboard-css").hide();
$("#newSimpleUserWin").fadeOut(function(){$("#newSimpleUserWin").remove();});});}function validateInputErr(id){var returnFlag=false;var validateType=$("#"+id).attr("validateType");var validateTypeArr=null;if(validateType){validateTypeArr=validateType.split(",");}if(validateTypeArr){var _tip="";var value=$.trim($("#"+id).val());var isEmpty=false;isEmpty=isHintInputEmpty($("#"+id));for(var i=0;i<validateTypeArr.length;i++){if(!isEmpty){if(validateTypeArr[i]=="email"&&!useUserName){if(!validateRules.isEmail(value)){_tip="请输入正确的电子邮箱地址！";
}}else{if(validateTypeArr[i]=="password"){if(!validateRules.isPassword(value)){_tip="请输入6-16位数字、字母或符号，区分大小写！";}}}}if(_tip!=""){$("#"+id+"_error_tip").show();$("#"+id+"_error_tip").text(_tip);returnFlag=true;}}}return returnFlag;}}initNewDetailUserWin=function(data,operateType){newUserOperateType=operateType;var json=null;if(newUserOperateType=="new"){var emailTitle;if(useUserName){emailTitle="用户名";}else{emailTitle="电子邮箱";}var email=data&&data.email?data.email:emailTitle;var emailClass=data&&data.email?"input_normal":"input_hint";
var passwordTipDisplay=data&&data.password?"none":"";var passwordDisplay=data&&data.password?"":"none";var password=data&&data.password?data.password:"";var name=data&&data.name?data.name:"姓名";var nameClass=data&&data.name?"input_normal":"input_hint";json={win_title:"新增用户",emailTitle:emailTitle,email:email,emailClass:emailClass,emailDefaultValue:emailTitle,password:password,passwordTipDisplay:passwordTipDisplay,passwordDisplay:passwordDisplay,name:name,nameClass:nameClass,nameDefaultValue:"姓名",phone:"电话",phoneDefaultValue:"电话",mobilePhone:"手机",mobilePhoneDefaultValue:"手机",xzqhdm:"行政区划代码",xzqhdmDefaultValue:"行政区划代码",xzqhmc:"行政区划名称",xzqhmcDefaultValue:"行政区划名称",address:"地址",addressDefaultValue:"地址"};
}else{if(newUserOperateType=="update"){var emailTitle;if(useUserName){emailTitle="用户名";}else{emailTitle="电子邮箱";}var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];json={win_title:"详细信息",emailTitle:emailTitle,email:selectNode.email,emailClass:"input_normal",emailDefaultValue:selectNode.email,name:selectNode.name,nameClass:"input_normal",nameDefaultValue:selectNode.name,phone:selectNode.phone,phoneDefaultValue:selectNode.phone,mobilePhone:selectNode.mobilePhone,mobilePhoneDefaultValue:selectNode.mobilePhone,xzqhdm:selectNode.xzqhdm,xzqhdmDefaultValue:selectNode.xzqhdm,xzqhmc:selectNode.xzqhmc,xzqhmcDefaultValue:selectNode.xzqhmc,address:selectNode.address,addressDefaultValue:selectNode.address};
}}$("body").append($.render($("#newDetailUserWin_template").html(),json));$("#newDetailUserWin").fadeIn();$("#newDetailUserWin").draggable({handle:$("#newDetailUserWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#newDetailUserWin .textInput").get(0),"events")!=undefined&&$._data($("#newDetailUserWin .textInput").get(0),"events")["focus"]!=undefined)){$("#newDetailUserWin .textInput").bind("focus",function(){if(this.id=="newDetailUserPasswordTip"){$(this).hide();$("#newDetailUserPassword").show();
$("#newDetailUserPassword").focus();}else{if(this.id=="newDetailUserPassword"){$(this).removeClass("textInput-n");$(this).addClass("textInput-f");$("#"+this.id+"_error_tip").hide();}else{if(newUserOperateType=="new"){if(isHintInputEmpty($(this))){$(this).val("");$(this).removeClass("input_hint");$(this).addClass("input_normal");}}$(this).removeClass("textInput-n");$(this).addClass("textInput-f");$("#"+this.id+"_error_tip").hide();}}$("#newDetailUserSaveBtn").removeAttr("disabled");});$("#newDetailUserWin .textInput").bind("blur",function(){$(this).removeClass("textInput-f");
$(this).addClass("textInput-n");if(newUserOperateType=="new"){var defaultValue=$(this).attr("defaultValue");if($.trim($(this).val())==""){if(this.id=="newDetailUserPassword"){$(this).hide();$("#newDetailUserPasswordTip").show();}else{$(this).val(defaultValue);$(this).removeClass("input_normal");$(this).addClass("input_hint");}}else{if(!validateInputErr(this.id,"new")){if(this.id=="newDetailUserEmail"){var email=$("#"+this.id).val();organizationView.omUserIsExit(email,function(response){if(response.returnFlag=="-1"){if(useUserName){$("#newDetailUserEmail_error_tip").text("用户名重复，请重新输入！");
}else{$("#newDetailUserEmail_error_tip").text("电子邮箱地址重复，请重新输入！");}$("#newDetailUserEmail_error_tip").show();}});}}}}else{if(newUserOperateType=="update"){if(!validateInputErr(this.id,"update")){if(this.id=="newDetailUserEmail"){var email=$("#"+this.id).val();var defaultEmail=$("#"+this.id).attr("defaultValue");if(email!=defaultEmail){organizationView.omUserIsExit(email,function(response){if(response.returnFlag=="-1"){if(useUserName){$("#newDetailUserEmail_error_tip").text("用户名重复，请重新输入！");}else{$("#newDetailUserEmail_error_tip").text("电子邮箱地址重复，请重新输入！");
}$("#newDetailUserEmail_error_tip").show();}});}}}}}});}if(newUserOperateType=="new"&&!(data&&data.email)){$("#newDetailUserEmail").focus();}else{var tempEmail=$("#newDetailUserEmail").val();$("#newDetailUserEmail").val("").focus().val(tempEmail);}if(newUserOperateType=="update"){$("#newDetailUserWin .textInput").removeClass("input_hint");$("#newDetailUserWin .textInput").addClass("input_normal");$(".newDetailUserPassword").remove();$("#newDetailUserWin").addClass("update_detail_user_win");}if(!($._data($("#newDetailUserSaveBtn").get(0),"events")!=undefined&&$._data($("#newDetailUserSaveBtn").get(0),"events")["click"]!=undefined)){$("#newDetailUserSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;
}else{$(this).attr("disabled",true);}var hasErr=false;var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];if(newUserOperateType=="new"){$("#newDetailUserWin .textInput").each(function(){var _tip="";if(this.id=="newDetailUserPasswordTip"){if($(this).is(":visible")){_tip="密码不能为空！";hasErr=true;$("#newDetailUserPassword_error_tip").text(_tip);$("#newDetailUserPassword_error_tip").show();}}else{if(this.id=="newDetailUserPassword"){if($(this).is(":visible")){if(validateInputErr(this.id,"new")){hasErr=true;
}}}else{if(isHintInputEmpty($(this))){switch(this.id){case"newDetailUserEmail":if(useUserName){_tip="用户名不能为空！";}else{_tip="电子邮箱不能为空！";}break;case"newDetailUserPassword":_tip="密码不能为空！";break;case"newDetailUserName":_tip="姓名不能为空！";break;}if(_tip!=""){$("#"+this.id+"_error_tip").text(_tip);$("#"+this.id+"_error_tip").show();hasErr=true;}}if(validateInputErr(this.id,"new")){hasErr=true;}}}});if(!hasErr){var email=$.trim($("#newDetailUserEmail").val());organizationView.omUserIsExit(email,function(response){if(response.returnFlag=="-1"){if(useUserName){$("#newDetailUserEmail_error_tip").text("用户名重复，请重新输入！");
}else{$("#newDetailUserEmail_error_tip").text("电子邮箱地址重复，请重新输入！");}$("#newDetailUserEmail_error_tip").show();}else{if(response.returnFlag=="0"){var parentId=selectNode.id;var type=USER_TYPE;var status=1;var password=isHintInputEmpty($("#newDetailUserPassword"))?"":$.trim($("#newDetailUserPassword").val());var name=isHintInputEmpty($("#newDetailUserName"))?"":$.trim($("#newDetailUserName").val());var phone=isHintInputEmpty($("#newDetailUserPhone"))?"":$.trim($("#newDetailUserPhone").val());var mobilePhone=isHintInputEmpty($("#newDetailUserMobilePhone"))?"":$.trim($("#newDetailUserMobilePhone").val());
var xzqhdm=isHintInputEmpty($("#newDetailUserXzqhdm"))?"":$.trim($("#newDetailUserXzqhdm").val());var xzqhmc=isHintInputEmpty($("#newDetailUserXzqhmc"))?"":$.trim($("#newDetailUserXzqhmc").val());var address=isHintInputEmpty($("#newDetailUserAddress"))?"":$.trim($("#newDetailUserAddress").val());var data={parentId:parentId,type:type,status:status,email:email,password:password,name:name,phone:phone,mobilePhone:mobilePhone,xzqhdm:xzqhdm,xzqhmc:xzqhmc,address:address};organizationView.addZTreeNode(data,"newDetailUserWin");
}}});}}else{if(newUserOperateType=="update"){$("#newDetailUserWin .textInput").each(function(){if(validateInputErr(this.id,"update")){hasErr=true;}});if(!hasErr){var name=$.trim($("#newDetailUserName").val());var email=$.trim($("#newDetailUserEmail").val());var phone=$.trim($("#newDetailUserPhone").val());var mobilePhone=$.trim($("#newDetailUserMobilePhone").val());var xzqhdm=$.trim($("#newDetailUserXzqhdm").val());var xzqhmc=$.trim($("#newDetailUserXzqhmc").val());var address=$.trim($("#newDetailUserAddress").val());
var defaultName=$("#newDetailUserName").attr("defaultvalue");var defaultEmail=$("#newDetailUserEmail").attr("defaultvalue");var defaultPhone=$("#newDetailUserPhone").attr("defaultvalue");var defaultMobilePhone=$("#newDetailUserMobilePhone").attr("defaultvalue");var defaultXzqhdm=$("#newDetailUserXzqhdm").attr("defaultvalue");var defaultXzqhmc=$("#newDetailUserXzqhmc").attr("defaultvalue");var defaultAddress=$("#newDetailUserAddress").attr("defaultvalue");if(name==defaultName&&email==defaultEmail&&phone==defaultPhone&&mobilePhone==defaultMobilePhone&&xzqhdm==defaultXzqhdm&&xzqhmc==defaultXzqhmc&&address==defaultAddress){$(".blackboard-css").hide();
$("#newDetailUserWin").fadeOut(function(){$("#newDetailUserWin").remove();});return;}var data={id:selectNode.id,type:selectNode.type,email:email,name:name,phone:phone,mobilePhone:mobilePhone,xzqhdm:xzqhdm,xzqhmc:xzqhmc,address:address};if(email==defaultEmail){organizationView.updateZTreeNode(selectNode,data,"newDetailUserWin");}else{organizationView.omUserIsExit(email,function(response){if(response.returnFlag=="-1"){if(useUserName){$("#newDetailUserEmail_error_tip").text("用户名重复，请重新输入！");}else{$("#newDetailUserEmail_error_tip").text("电子邮箱地址重复，请重新输入！");
}$("#newDetailUserEmail_error_tip").show();}else{if(response.returnFlag=="0"){organizationView.updateZTreeNode(selectNode,data,"newDetailUserWin");}}});}}}}});}if(!($._data($("#newDetailUserCancelBtn").get(0),"events")!=undefined&&$._data($("#newDetailUserCancelBtn").get(0),"events")["click"]!=undefined)){$("#newDetailUserCancelBtn").bind("click",function(){$(".blackboard-css").hide();$("#newDetailUserWin").fadeOut(function(){$("#newDetailUserWin").remove();});});}if(!($._data($("#newDetailUserWin .win_close").get(0),"events")!=undefined&&$._data($("#newDetailUserWin .win_close").get(0),"events")["click"]!=undefined)){$("#newDetailUserWin .win_close").bind("click",function(){$(".blackboard-css").hide();
$("#newDetailUserWin").fadeOut(function(){$("#newDetailUserWin").remove();});});}function validateInputErr(id,type){var returnFlag=false;var validateType=$("#"+id).attr("validateType");var validateTypeArr=null;if(validateType){validateTypeArr=validateType.split(",");}if(validateTypeArr){var _tip="";var value=$.trim($("#"+id).val());var isEmpty=false;if(type=="new"){isEmpty=isHintInputEmpty($("#"+id));}else{if(type=="update"){isEmpty=value==""?true:false;}}for(var i=0;i<validateTypeArr.length;i++){if(isEmpty){if(type=="update"&&validateTypeArr[i]=="required"){if(id=="newDetailUserName"){_tip="姓名不能为空！";
}else{if(id=="newDetailUserPassword"){_tip="密码不能为空！";}else{if(id=="newDetailUserEmail"){if(useUserName){_tip="用户名不能为空！";}else{_tip="电子邮箱不能为空！";}}}}}}else{if(validateTypeArr[i]=="email"){if(!validateRules.isEmail(value)&&!useUserName){_tip="请输入正确的电子邮箱地址！";}}else{if(validateTypeArr[i]=="password"){if(!validateRules.isPassword(value)){_tip="请输入6-16位数字、字母或符号，区分大小写！";}}else{if(validateTypeArr[i]=="phone"){if(!validateRules.isPhone(value)){_tip="请输入正确的电话号码！";}}else{if(validateTypeArr[i]=="mobilePhone"){if(!validateRules.isMobilePhone(value)){_tip="请输入正确的手机号码！";
}}}}}}if(_tip!=""){$("#"+id+"_error_tip").show();$("#"+id+"_error_tip").text(_tip);returnFlag=true;break;}}}return returnFlag;}};this.initContainUserWin=function(){changeUserArray=new Array();$(".blackboard-css").show();$("body").append($("#containUserWin_template").html());$("#containUserWin").fadeIn();$("#containUserWin").draggable({handle:$("#containUserWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});var setting={async:{enable:true,url:path+"/ts/omGetZTreeAllUser?"},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId",rootPId:0}},check:{enable:true},view:{showLine:false},callback:{onAsyncSuccess:onAsyncSuccess,onCheck:onCheck}};
$.fn.zTree.init($("#allUserZTree"),setting,null);function onAsyncSuccess(event,treeId,treeNode,msg){allUserData=eval(msg);var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectOrganizationNode=organizationZTree.getSelectedNodes()[0];organizationView.omGetUserByOrganization(function(data){if(data&&data.length>0){var allUserZTree=$.fn.zTree.getZTreeObj("allUserZTree");for(var i=0;i<data.length;i++){var treeNode=allUserZTree.getNodeByParam("id",data[i].id);allUserZTree.checkNode(treeNode,true,false);
}isAllSelectedStatus();}},selectOrganizationNode);}function onCheck(event,treeId,treeNode){isAllSelectedStatus();for(var i=0;i<changeUserArray.length;i++){if(changeUserArray[i].id==treeNode.id){changeUserArray.splice(i,1);return;}}var type=treeNode.checked?0:1;var json={id:treeNode.id,type:type};changeUserArray.push(json);}function isAllSelectedStatus(){var allUserZTree=$.fn.zTree.getZTreeObj("allUserZTree");var allNodes=allUserZTree.getNodes();var checkedNodes=allUserZTree.getCheckedNodes();var _selectAllUser=$("#selectAllUser");
if(allNodes.length==checkedNodes.length){if(_selectAllUser.hasClass("checkbox_n")){_selectAllUser.removeClass("checkbox_n");_selectAllUser.addClass("checkbox_s");}}else{if(_selectAllUser.hasClass("checkbox_s")){_selectAllUser.removeClass("checkbox_s");_selectAllUser.addClass("checkbox_n");}}}if(!($._data($("#selectAllUser").get(0),"events")!=undefined&&$._data($("#selectAllUser").get(0),"events")["click"]!=undefined)){$("#selectAllUser").bind("click",function(){var allUserZTree=$.fn.zTree.getZTreeObj("allUserZTree");
if($(this).hasClass("checkbox_n")){$(this).removeClass("checkbox_n");$(this).addClass("checkbox_s");var unCheckedNodes=allUserZTree.getCheckedNodes(false);changeUserArrayMethod(unCheckedNodes,0);allUserZTree.checkAllNodes(true);}else{if($(this).hasClass("checkbox_s")){$(this).removeClass("checkbox_s");$(this).addClass("checkbox_n");var checkedNodes=allUserZTree.getCheckedNodes(true);changeUserArrayMethod(checkedNodes,1);allUserZTree.checkAllNodes(false);}}function changeUserArrayMethod(nodes,type){for(var i=0;
i<nodes.length;i++){if(changeUserArray.length>0){for(var j=0;j<changeUserArray.length;j++){if(nodes[i].id==changeUserArray[j].id){changeUserArray.splice(j,1);break;}if(j==changeUserArray.length-1){var json={id:nodes[i].id,type:type};changeUserArray.push(json);break;}}}else{if(changeUserArray.length==0){var json={id:nodes[i].id,type:type};changeUserArray.push(json);}}}}});}if(!($._data($("#containUserSaveBtn").get(0),"events")!=undefined&&$._data($("#containUserSaveBtn").get(0),"events")["click"]!=undefined)){$("#containUserSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;
}else{$(this).attr("disabled",true);}if(changeUserArray&&changeUserArray.length==0){$(".blackboard-css").hide();$("#containUserWin").fadeOut(function(){$("#containUserWin").remove();});return;}var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var organizationNode=organizationZTree.getSelectedNodes()[0];organizationView.omChangeOrganizationContainUser(organizationNode,changeUserArray,allUserData);});}if(!($._data($("#containUserCancelBtn").get(0),"events")!=undefined&&$._data($("#containUserCancelBtn").get(0),"events")["click"]!=undefined)){$("#containUserCancelBtn").bind("click",function(){$(".blackboard-css").hide();
$("#containUserWin").fadeOut(function(){$("#containUserWin").remove();});});}if(!($._data($("#containUserWin .win_close").get(0),"events")!=undefined&&$._data($("#containUserWin .win_close").get(0),"events")["click"]!=undefined)){$("#containUserWin .win_close").bind("click",function(){$(".blackboard-css").hide();$("#containUserWin").fadeOut(function(){$("#containUserWin").remove();});});}};this.initRelieveOrganizationWin=function(){$(".blackboard-css").show();$("body").append($("#relieveOrganizationWin_template").html());
$("#relieveOrganizationWin").fadeIn();$("#relieveOrganizationWin").draggable({handle:$("#relieveOrganizationWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});relieveOrganizationArray=new Array();var setting={async:{enable:true,url:path+"/ts/omGetZTreeAllOrganization?"},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId",rootPId:-2}},check:{enable:true,chkboxType:{"Y":"","N":""}},view:{showLine:false},callback:{onAsyncSuccess:onAsyncSuccess,beforeCheck:beforeCheck,onCheck:onCheck}};
var ORGANIZATION_ROOT_ID=-1;var zNodes=[{"id":ORGANIZATION_ROOT_ID,"name":"组织","type":0,"parentId":-2,"open":false,"isParent":true,"iconSkin":"icon-organization-double"}];$.fn.zTree.init($("#allOrganizationZTree"),setting,zNodes);var allOrganizationZTree=$.fn.zTree.getZTreeObj("allOrganizationZTree");var rootNode=allOrganizationZTree.getNodeByParam("id",ORGANIZATION_ROOT_ID,null);allOrganizationZTree.expandNode(rootNode,true,false,true);function onAsyncSuccess(event,treeId,treeNode,msg){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");
var selectUserNode=organizationZTree.getSelectedNodes()[0];organizationView.omGetOrganizationByUser(function(data){if(data&&data.length>0){var allOrganizationZTree=$.fn.zTree.getZTreeObj("allOrganizationZTree");for(var i=0;i<data.length;i++){var treeNode=allOrganizationZTree.getNodeByParam("id",data[i].id);allOrganizationZTree.checkNode(treeNode,true,false);}}},selectUserNode);}function beforeCheck(treeId,treeNode){if(treeNode.checked){var allOrganizationZTree=$.fn.zTree.getZTreeObj("allOrganizationZTree");
var checkedNodes=allOrganizationZTree.getCheckedNodes(true);if(checkedNodes.length==1){if($("#userSelectOrganization_tip").is(":hidden")){$("#userSelectOrganization_tip").show();setTimeout(function(){$("#userSelectOrganization_tip").fadeOut();},1000);}return false;}}}function onCheck(event,treeId,treeNode){for(var i=0;i<relieveOrganizationArray.length;i++){if(relieveOrganizationArray[i].id==treeNode.id){relieveOrganizationArray.splice(i,1);return;}}var type=treeNode.checked?0:1;var json={id:treeNode.id,type:type};
relieveOrganizationArray.push(json);}if(!($._data($("#relieveOrganizationSaveBtn").get(0),"events")!=undefined&&$._data($("#relieveOrganizationSaveBtn").get(0),"events")["click"]!=undefined)){$("#relieveOrganizationSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;}else{$(this).attr("disabled",true);}if(relieveOrganizationArray&&relieveOrganizationArray.length==0){$(".blackboard-css").hide();$("#relieveOrganizationWin").fadeOut(function(){$("#relieveOrganizationWin").remove();
});return;}var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var userNode=organizationZTree.getSelectedNodes()[0];organizationView.omChangeUserRelieveOrganization(userNode,relieveOrganizationArray);});}if(!($._data($("#relieveOrganizationCancelBtn").get(0),"events")!=undefined&&$._data($("#relieveOrganizationCancelBtn").get(0),"events")["click"]!=undefined)){$("#relieveOrganizationCancelBtn").bind("click",function(){$(".blackboard-css").hide();$("#relieveOrganizationWin").fadeOut(function(){$("#relieveOrganizationWin").remove();
});});}if(!($._data($("#relieveOrganizationWin .win_close").get(0),"events")!=undefined&&$._data($("#relieveOrganizationWin .win_close").get(0),"events")["click"]!=undefined)){$("#relieveOrganizationWin .win_close").bind("click",function(){$(".blackboard-css").hide();$("#relieveOrganizationWin").fadeOut(function(){$("#relieveOrganizationWin").remove();});});}};this.initMoreInformationWin=function(){$(".blackboard-css").show();var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectUserNode=organizationZTree.getSelectedNodes()[0];
if(selectUserNode.type==ORGANIZATION_TYPE){$("body").append($.render($("#moreInformationWin_template").html(),{local_title:"包含用户"}));var titles=["组织名称：","电子邮箱：","电话：","手机：","地址："];var values=[selectUserNode.name,selectUserNode.email,selectUserNode.phone,selectUserNode.mobilePhone,selectUserNode.address];for(var i=0;i<titles.length;i++){var json={title:titles[i],value:values[i]};var _moreInformationTableTr=$.render($("#moreInformationTableTr_template").html(),json);$("#moreInformationTable").append(_moreInformationTableTr);
}organizationView.omGetUserByOrganization(appendUsers,selectUserNode);}else{if(selectUserNode.type==USER_TYPE){$("body").append($.render($("#moreInformationWin_template").html(),{local_title:"归属组织"}));var emailTitle;if(useUserName){emailTitle="用户名：";}else{emailTitle="电子邮箱：";}var titles=["姓名：",emailTitle,"电话：","手机：","行政区划代码：","行政区划名称：","地址："];var values=[selectUserNode.name,selectUserNode.email,selectUserNode.phone,selectUserNode.mobilePhone,selectUserNode.xzqhdm,selectUserNode.xzqhmc,selectUserNode.address];
for(var i=0;i<titles.length;i++){var json={title:titles[i],value:values[i]};var _moreInformationTableTr=$.render($("#moreInformationTableTr_template").html(),json);$("#moreInformationTable").append(_moreInformationTableTr);}$("#moreInformationWin").addClass("user_detail_win");$("#updateUserPasswordBtn").show();organizationView.omGetOrganizationByUser(appendOrganizations,selectUserNode);if(!($._data($("#updateUserPasswordBtn").get(0),"events")!=undefined&&$._data($("#updateUserPasswordBtn").get(0),"events")["click"]!=undefined)){$("#updateUserPasswordBtn").bind("click",function(){$("#moreInformationWin").fadeOut(function(){$("#moreInformationWin").remove();
});initChangePasswordWin();});}}}$("#moreInformationWin").fadeIn();$("#moreInformationWin").draggable({handle:$("#moreInformationWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#moreInformationEditBtn").get(0),"events")!=undefined&&$._data($("#moreInformationEditBtn").get(0),"events")["click"]!=undefined)){$("#moreInformationEditBtn").bind("click",function(){$("#moreInformationWin").fadeOut(function(){$("#moreInformationWin").remove();});var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");
var selectUserNode=organizationZTree.getSelectedNodes()[0];if(selectUserNode.type==ORGANIZATION_TYPE){initNewDetailOrganizationWin(null,"update");}else{if(selectUserNode.type==USER_TYPE){initNewDetailUserWin(null,"update");}}});}if(!($._data($("#moreInformationWin .win_close").get(0),"events")!=undefined&&$._data($("#moreInformationWin .win_close").get(0),"events")["click"]!=undefined)){$("#moreInformationWin .win_close").bind("click",function(){$(".blackboard-css").hide();$("#moreInformationWin").fadeOut(function(){$("#moreInformationWin").remove();
});});}function appendUsers(data){if(data&&data.length>0){for(var i=0;i<data.length;i++){var name=data[i].name;var tempName=name_limit(name,12);var name_title="";if(name!=tempName){name_title=name;}var json={icon_class:"userItem_img",name:tempName,name_title:name_title};var _organizationItem=$.render($("#organizationItem_template").html(),json);$("#organization_list_ul").append(_organizationItem);}}var json={jump_class:"containUser containUser_n"};var _organizationIumpItem=$.render($("#organizationIumpItem_template").html(),json);
$("#organization_list_ul").append(_organizationIumpItem);if(!($._data($(".containUser").get(0),"events")!=undefined&&$._data($(".containUser").get(0),"events")["click"]!=undefined)){$(".containUser").bind("click",function(){$("#moreInformationWin").fadeOut(function(){$("#moreInformationWin").remove();});_windowView.initContainUserWin();});}}function appendOrganizations(data){if(data&&data.length>0){for(var i=0;i<data.length;i++){var name=data[i].name;var tempName=name_limit(name,12);var name_title="";
if(name!=tempName){name_title=name;}var json={icon_class:"organizationItem_img",name:tempName,name_title:name_title};var _organizationItem=$.render($("#organizationItem_template").html(),json);$("#organization_list_ul").append(_organizationItem);}}var json={jump_class:"relieveOrganization relieveOrganization_n"};var _organizationIumpItem=$.render($("#organizationIumpItem_template").html(),json);$("#organization_list_ul").append(_organizationIumpItem);if(!($._data($(".relieveOrganization").get(0),"events")!=undefined&&$._data($(".relieveOrganization").get(0),"events")["click"]!=undefined)){$(".relieveOrganization").bind("click",function(){$("#moreInformationWin").fadeOut(function(){$("#moreInformationWin").remove();
});_windowView.initRelieveOrganizationWin();});}}};var initChangePasswordWin=function(){$("body").append($("#changePasswordWin_template").html());$("#changePasswordWin").fadeIn();$("#changePasswordWin").draggable({handle:$("#changePasswordWin h4"),onDrag:function(e){limitEasyUiDrag(e,this.id);}});if(!($._data($("#changePasswordWin .textInput").get(0),"events")!=undefined&&$._data($("#changePasswordWin .textInput").get(0),"events")["focus"]!=undefined)){$("#changePasswordWin .textInput").bind("focus",function(){$(this).removeClass("textInput-n");
$(this).addClass("textInput-f");var id=this.id;$("#"+id+"_error_tip").hide();$("#changePasswordSaveBtn").removeAttr("disabled");});$("#changePasswordWin .textInput").bind("blur",function(){$(this).removeClass("textInput-f");$(this).addClass("textInput-n");var id=this.id;validateInputErr(id);});}$("#newPassword").focus();if(!($._data($("#changePasswordSaveBtn").get(0),"events")!=undefined&&$._data($("#changePasswordSaveBtn").get(0),"events")["click"]!=undefined)){$("#changePasswordSaveBtn").bind("click",function(){if($(this).attr("disabled")){return;
}else{$(this).attr("disabled",true);}var hasErr=false;$("#changePasswordWin .textInput").each(function(){var id=this.id;if(validateInputErr(id)){hasErr=true;}});if(!hasErr){var organizationZTree=$.fn.zTree.getZTreeObj("organizationZTree");var selectNode=organizationZTree.getSelectedNodes()[0];var id=selectNode.id;var newPassword=$("#newPassword").val();var data={"id":id,"new":newPassword};organizationView.omUpdatePassword(data);}});}if(!($._data($("#changePasswordCancelBtn").get(0),"events")!=undefined&&$._data($("#changePasswordCancelBtn").get(0),"events")["click"]!=undefined)){$("#changePasswordCancelBtn").bind("click",function(){$(".blackboard-css").hide();
$("#changePasswordWin").fadeOut(function(){$("#changePasswordWin").remove();});});}if(!($._data($("#changePasswordCancelBtn").get(0),"events")!=undefined&&$._data($("#changePasswordCancelBtn").get(0),"events")["click"]!=undefined)){$("#changePasswordCancelBtn").bind("click",function(){$(".blackboard-css").hide();$("#changePasswordWin").fadeOut(function(){$("#changePasswordWin").remove();});});}if(!($._data($("#changePasswordWin .win_close").get(0),"events")!=undefined&&$._data($("#changePasswordWin .win_close").get(0),"events")["click"]!=undefined)){$("#changePasswordWin .win_close").bind("click",function(){$(".blackboard-css").hide();
$("#changePasswordWin").fadeOut(function(){$("#changePasswordWin").remove();});});}function validateInputErr(id){var value=$("#"+id).val();var _tip="";var returnFlag=false;if(id=="newPassword"){if(value==""){_tip="新密码不能为空";}else{if(!validateRules.isPassword(value)){_tip="请输入6-16位数字、字母或符号，区分大小写！";}}}else{if(id=="confirmNewPassword"){if(value==""){_tip="确认新密码不能为空";}else{var newPassord=$("#newPassword").val();if(newPassord!=value){_tip="与输入新密码不一致";}}}}if(_tip!=""){$("#"+id+"_error_tip").show();$("#"+id+"_error_tip").text(_tip);
returnFlag=true;}return returnFlag;}};function limitEasyUiDrag(e,windId){var d=e.data;var marginLeft=parseInt($("#"+windId).css("margin-left"))*-1;var marginTop=parseInt($("#"+windId).css("margin-top"))*-1;var maxLeft=$(window).width()-marginLeft;var maxTop=$(window).height()-marginTop;if(d.left<marginLeft){d.left=marginLeft;}else{if(d.left>maxLeft){d.left=maxLeft;}}if(d.top<marginTop){d.top=marginTop;}else{if(d.top>maxTop){d.top=maxTop;}}}}$.extend({HttpUtil:{}});$.extend($.HttpUtil,{doAjax:function(_url,_params,callBack){$.ajax({type:"post",dataType:"json",contentType:"application/x-www-form-urlencoded",url:_url,data:_params,error:function(XMLHttpRequest,textStatus,errorThrown){if(XMLHttpRequest.status!=0){$.messager.alert("操作提示","数据获取异常，请刷新重试！","error");
}},success:function(response,textStatus){if(response!=null){if(response.returnFlag==0){if(callBack!=null){callBack(response);}}else{$.messager.alert("操作提示",response.data,"error",function(){if(response.data=="您未登录或离开系统过久,请重新登录!"){window.location.href=path;}});}}}});},doSimpleAjax:function(_url,_params,callBack){$.ajax({type:"post",dataType:"json",contentType:"application/x-www-form-urlencoded",url:_url,data:_params,error:function(XMLHttpRequest,textStatus,errorThrown){$.messager.alert("操作提示","数据获取异常，请刷新重试！","error");
},success:function(response,textStatus){if(callBack!=null){callBack(response);}}});}});